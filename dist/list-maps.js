"use strict";
/// <reference types="jquery" />
var ListMaps;
(function (ListMaps) {
    var SummaryRow = /** @class */ (function () {
        function SummaryRow(data) {
            this.data = data;
            this.approved_status = data[0], this.approved_date = data[1], this.mode = data[2], this.beatmap_id = data[3], this.beatmapset_id = data[4], this.display_string = data[5], this.stars = data[6], this.pp = data[7], this.hit_length = data[8], this.max_combo = data[9], this.approach_rate = data[10], this.circle_size = data[11], this.min_misses = data[12], this.fcNM = data[13], this.fcHD = data[14], this.fcHR = data[15], this.fcHDHR = data[16], this.fcDT = data[17], this.fcHDDT = data[18];
            this.display_string_lower = this.display_string.toLowerCase();
        }
        return SummaryRow;
    }());
    var summaryRows = [];
    var unsortedTableRows = [];
    var currentSortOrder = [];
    var currentHashLink = '#';
    var previousIndices = '';
    function drawTable(indices) {
        var str = indices.join(',');
        if (previousIndices === str)
            return;
        previousIndices = str;
        $('#summary-table > tbody')
            .html('')
            .append(indices.map(function (index) { return unsortedTableRows[index]; }));
    }
    var SearchQuery = /** @class */ (function () {
        function SearchQuery(source) {
            this.source = source;
            var key_to_property_name = {
                'status': 'approved_status',
                'mode': 'mode',
                'stars': 'stars',
                'pp': 'pp',
                'length': 'hit_length',
                'combo': 'max_combo',
                'ar': 'approach_rate',
                'cs': 'circle_size',
            };
            var check_func_source = 'return true';
            this.normalized_source = '';
            for (var _i = 0, _a = source.split(' '); _i < _a.length; _i++) {
                var token = _a[_i];
                var trimmed = token.trim();
                if (trimmed === '')
                    continue;
                var match = /(status|mode|stars|pp|length|combo|ar|cs)(<|<=|>|>=|=|!=)([-\d\.]+)/.exec(trimmed);
                if (match) {
                    var key = match[1];
                    var rel = match[2] === '=' ? '==' : match[2];
                    var val = parseFloat(match[3]);
                    if (isNaN(val))
                        continue;
                    var prop = key_to_property_name[key];
                    if (this.normalized_source !== '')
                        this.normalized_source += ' ';
                    this.normalized_source += match[1] + match[2] + match[3];
                    check_func_source += "&&row." + prop + rel + val;
                }
                else {
                    var str = trimmed.toLowerCase();
                    var escaped = JSON.stringify(str);
                    if (this.normalized_source !== '')
                        this.normalized_source += ' ';
                    this.normalized_source += str;
                    check_func_source += "&&row.display_string_lower.indexOf(" + escaped + ")!==-1";
                }
            }
            this.check = new Function('row', check_func_source);
        }
        return SearchQuery;
    }());
    var sortKeys = [
        function (x) { return x.approved_date; },
        function (x) { return x.display_string; },
        function (x) { return x.stars; },
        function (x) { return x.pp; },
        function (x) { return x.hit_length; },
        function (x) { return x.max_combo; },
        function (x) { return x.approach_rate; },
        function (x) { return x.circle_size; },
        function (x) {
            return x.fcHDDT * 2 + x.fcDT * 1e8 +
                x.fcHDHR * 2 + x.fcHR * 1e4 +
                x.fcHD * 2 + x.fcNM -
                x.min_misses;
        },
    ];
    function stringifyObject(obj) {
        return Object.keys(obj)
            .map(function (k) { return k + '=' + encodeURIComponent(obj[k]); })
            .join('&');
    }
    function parseObject(str) {
        var res = {};
        str.split('&').forEach(function (part) {
            var match = part.match(/(\w+)=(.+)/);
            if (match)
                res[match[1]] = decodeURIComponent(match[2]);
        });
        return res;
    }
    function drawTableForCurrentFiltering() {
        var filter_approved_status = parseInt($('*[name="filter_approved_status"]').val());
        var filter_mode = parseInt($('*[name="filter_mode"]').val());
        var filter_search_query = new SearchQuery($('*[name="filter_search_query"]').val());
        var filter_fc_level = parseInt($('*[name="filter_fc_level"]').val());
        var get_fc_level = function (row) {
            if (row.min_misses !== 0)
                return 1;
            if (row.fcDT !== 0 || row.fcHDDT !== 0)
                return 8;
            if (row.fcNM === 0 && row.fcHD === 0 && row.fcHR === 0 && row.fcHDHR === 0)
                return 2;
            if (row.fcNM === 0 && row.fcHD === 0)
                return 3;
            if (row.fcHD === 0)
                return 4;
            if (row.fcHR === 0 && row.fcHDHR === 0)
                return 5;
            if (row.fcHDHR === 0)
                return 6;
            return 7;
        };
        currentHashLink = '#';
        var obj = {};
        if (filter_approved_status !== 1)
            obj.s = filter_approved_status.toString();
        if (filter_mode !== 1)
            obj.m = filter_mode.toString();
        if (filter_search_query.normalized_source !== '')
            obj.q = filter_search_query.normalized_source;
        if (filter_fc_level !== 0)
            obj.l = filter_fc_level.toString();
        if (currentSortOrder.length !== 0)
            obj.o = currentSortOrder.join('.');
        currentHashLink += stringifyObject(obj);
        if (currentHashLink === '#')
            history.replaceState({}, document.title, location.pathname);
        else
            location.hash = currentHashLink;
        var indices = summaryRows.map(function (_, index) { return index; }).filter(function (index) {
            var row = summaryRows[index];
            if (filter_approved_status === 1 &&
                (row.approved_status !== 1 && row.approved_status !== 2))
                return false;
            if (filter_approved_status === 2 && row.approved_status !== 4)
                return false;
            if (filter_mode === 1 && row.mode !== 0)
                return false;
            if (filter_mode === 2 && row.mode !== 2)
                return false;
            if (!filter_search_query.check(row))
                return false;
            if (filter_fc_level !== 0 && get_fc_level(row) !== filter_fc_level)
                return false;
            return true;
        });
        var _loop_1 = function (ord) {
            if (ord === 0)
                return "continue";
            var prevIndex = Array(indices.length);
            indices.forEach(function (x, i) { return prevIndex[x] = i; });
            var sortKey = sortKeys[Math.abs(ord) - 1];
            var sign = ord > 0 ? 1 : -1;
            indices.sort(function (x, y) {
                var kx = sortKey(summaryRows[x]);
                var ky = sortKey(summaryRows[y]);
                return kx < ky ? -sign : kx > ky ? sign : prevIndex[y] - prevIndex[x];
            });
        };
        for (var _i = 0, currentSortOrder_1 = currentSortOrder; _i < currentSortOrder_1.length; _i++) {
            var ord = currentSortOrder_1[_i];
            _loop_1(ord);
        }
        $('#hash-link-to-the-current-table').attr('href', currentHashLink);
        drawTable(indices);
    }
    function simplySortOrder(order) {
        var res = [];
        var seen = Array(sortKeys.length);
        for (var i = order.length - 1; i >= 0; --i) {
            var x = order[i];
            if (x === 0)
                continue;
            var key = Math.abs(x) - 1, sign = x > 0 ? 1 : -1;
            if (seen[key])
                continue;
            seen[key] = sign;
            res.push(x);
            if ([0, 1, 2, 3, 4, 5].indexOf(key) !== -1)
                break;
        }
        if (res.length !== 0 && res[res.length - 1] === -3)
            res.pop();
        res.reverse();
        return res;
    }
    function setQueryAccordingToHash() {
        var obj;
        try {
            obj = parseObject(location.hash.substr(1));
        }
        catch (e) {
            obj = {};
        }
        if (typeof (obj.s) === 'undefined')
            obj.s = '1';
        if (typeof (obj.m) === 'undefined')
            obj.m = '1';
        if (typeof (obj.q) === 'undefined')
            obj.q = '';
        if (typeof (obj.l) === 'undefined')
            obj.l = '0';
        if (typeof (obj.o) === 'undefined')
            obj.o = '';
        $('*[name="filter_approved_status"]').val(parseInt(obj.s));
        $('*[name="filter_mode"]').val(parseInt(obj.m));
        $('*[name="filter_search_query"]').val(obj.q);
        $('*[name="filter_fc_level"]').val(parseInt(obj.l));
        currentSortOrder = simplySortOrder(obj.o.split('.').map(function (x) { return parseInt(x) || 0; }));
        setTableHeadSortingMark();
    }
    function setTableHeadSortingMark() {
        $('.sorted').removeClass('sorted ascending descending');
        var x = currentSortOrder.length === 0 ?
            -3 : // stars desc
            currentSortOrder[currentSortOrder.length - 1];
        var index = Math.abs(x) - 1;
        $($('#summary-table > thead > tr > th')[index])
            .addClass('sorted').addClass(x > 0 ? 'ascending' : 'descending');
    }
    $(function () {
        setQueryAccordingToHash();
        window.addEventListener('hashchange', function () {
            setQueryAccordingToHash();
            drawTableForCurrentFiltering();
        });
        var onChange = function () {
            drawTableForCurrentFiltering();
        };
        for (var _i = 0, _a = ['filter_approved_status', 'filter_mode', 'filter_fc_level']; _i < _a.length; _i++) {
            var name_1 = _a[_i];
            $("select[name=\"" + name_1 + "\"]").on('change', onChange);
        }
        for (var _b = 0, _c = ['filter_search_query']; _b < _c.length; _b++) {
            var name_2 = _c[_b];
            $("input[name=\"" + name_2 + "\"]").on('input', onChange);
        }
        var thList = $('#summary-table > thead > tr > th');
        sortKeys.forEach(function (_, index) {
            $.data(thList[index], 'thIndex', index);
        });
        $.getJSON('data/summary.json').then(function (data, _, xhr) {
            var last_modified = new Date(xhr.getResponseHeader('Last-Modified'));
            $('#last-update-time')
                .attr('datetime', last_modified.toISOString())
                .text(last_modified.toISOString().split('T')[0]);
            var pad = function (x) { return (x < 10 ? '0' : '') + x; };
            var mode_icons = [
                'exchange icon',
                '',
                'theme icon',
                '',
            ];
            var approved_status_icons = [
                'help icon',
                'angle double up icon',
                'fire icon',
                'checkmark icon',
                'empty heart icon',
            ];
            summaryRows = data.map(function (x) { return new SummaryRow(x); });
            unsortedTableRows = summaryRows.map(function (row) {
                return $('<tr>').append([
                    [
                        $('<i>').addClass(approved_status_icons[row.approved_status]),
                        document.createTextNode(row.approved_date.split(' ')[0])
                    ],
                    [
                        $('<i>').addClass(mode_icons[row.mode]),
                        $('<a>')
                            .attr('href', "https://osu.ppy.sh/b/" + row.beatmap_id + "?m=2")
                            .text(row.display_string),
                        $('<div style="float:right">').append([
                            $('<a><i class="image icon">')
                                .attr('href', "https://b.ppy.sh/thumb/" + row.beatmapset_id + ".jpg"),
                            $('<a><i class="download icon">')
                                .attr('href', "https://osu.ppy.sh/d/" + row.beatmapset_id + "n")
                        ])
                    ],
                    row.stars.toFixed(2),
                    row.pp.toFixed(0),
                    Math.floor(row.hit_length / 60) + ":" + pad(Math.floor(row.hit_length % 60)),
                    row.max_combo.toString(),
                    row.approach_rate.toFixed(1),
                    row.circle_size.toFixed(1),
                    row.min_misses !== 0 ? (row.min_misses === 1 ? '1 miss' : row.min_misses + ' misses') :
                        [row.fcNM, row.fcHD, row.fcHR, row.fcHDHR, row.fcDT, row.fcHDDT].join(', ')
                ].map(function (x) { return $('<td>').append(x); }))[0];
            });
            drawTableForCurrentFiltering();
            $('#summary-table-loader').removeClass('active');
        });
        thList.click(function (event) {
            var th = $(event.target);
            var sign;
            if (th.hasClass('sorted'))
                sign = th.hasClass('descending') ? 1 : -1;
            else
                sign = th.hasClass('desc-first') ? -1 : 1;
            var thIndex = th.data('thIndex');
            currentSortOrder.push((thIndex + 1) * sign);
            currentSortOrder = simplySortOrder(currentSortOrder);
            setTableHeadSortingMark();
            drawTableForCurrentFiltering();
        });
    });
})(ListMaps || (ListMaps = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1tYXBzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2xpc3QtbWFwcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsZ0NBQWdDO0FBQ2hDLElBQVUsUUFBUSxDQXdXakI7QUF4V0QsV0FBVSxRQUFRO0lBZWxCO1FBcUJJLG9CQUE2QixJQUFvQjtZQUFwQixTQUFJLEdBQUosSUFBSSxDQUFnQjtZQUV6Qyw4QkFBb0IsRUFDcEIsNEJBQWtCLEVBQ2xCLG1CQUFTLEVBQ1QseUJBQWUsRUFDZiw0QkFBa0IsRUFDbEIsNkJBQW1CLEVBQ25CLG9CQUFVLEVBQ1YsaUJBQU8sRUFDUCx5QkFBZSxFQUNmLHdCQUFjLEVBQ2QsNkJBQWtCLEVBQ2xCLDJCQUFnQixFQUNoQiwwQkFBZSxFQUNmLG9CQUFTLEVBQ1Qsb0JBQVMsRUFDVCxvQkFBUyxFQUNULHNCQUFXLEVBQ1gsb0JBQVMsRUFDVCxzQkFBVyxDQUNOO1lBQ1QsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbEUsQ0FBQztRQUNMLGlCQUFDO0lBQUQsQ0FBQyxBQTdDRCxJQTZDQztJQUVELElBQUksV0FBVyxHQUFpQixFQUFFLENBQUM7SUFDbkMsSUFBSSxpQkFBaUIsR0FBMEIsRUFBRSxDQUFDO0lBQ2xELElBQUksZ0JBQWdCLEdBQWEsRUFBRSxDQUFDO0lBQ3BDLElBQUksZUFBZSxHQUFHLEdBQUcsQ0FBQztJQUUxQixJQUFJLGVBQWUsR0FBRyxFQUFFLENBQUM7SUFDekIsbUJBQW1CLE9BQWlCO1FBQ2hDLElBQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUIsRUFBRSxDQUFDLENBQUMsZUFBZSxLQUFLLEdBQUcsQ0FBQztZQUFDLE1BQU0sQ0FBQztRQUNwQyxlQUFlLEdBQUcsR0FBRyxDQUFDO1FBQ3RCLENBQUMsQ0FBQyx3QkFBd0IsQ0FBQzthQUN0QixJQUFJ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QUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3RCLElBQUksR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlDLElBQUk7Z0JBQ0EsSUFBSSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUMsSUFBTSxPQUFPLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQVcsQ0FBQztZQUM3QyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDNUMsZ0JBQWdCLEdBQUcsZUFBZSxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDckQsdUJBQXVCLEVBQUUsQ0FBQztZQUMxQiw0QkFBNEIsRUFBRSxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFFSCxDQUFDLEVBeFdTLFFBQVEsS0FBUixRQUFRLFFBd1dqQiIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHR5cGVzPVwianF1ZXJ5XCIgLz5cclxubmFtZXNwYWNlIExpc3RNYXBzIHtcclxuXHJcbmludGVyZmFjZSBKUXVlcnkge1xyXG4gICAgdGFibGVzb3J0KCk6IHZvaWQ7XHJcbiAgICBkYXRhKGtleTogJ3NvcnRCeScsIGtleUZ1bmM6IChcclxuICAgICAgICB0aDogSFRNTFRhYmxlSGVhZGVyQ2VsbEVsZW1lbnQsXHJcbiAgICAgICAgdGQ6IEhUTUxUYWJsZURhdGFDZWxsRWxlbWVudCxcclxuICAgICAgICB0YWJsZXNvcnQ6IGFueSkgPT4gdm9pZCk6IHRoaXM7XHJcbn1cclxuXHJcbnR5cGUgU3VtbWFyeVJvd0RhdGEgPVxyXG5bXHJcbiAgICBudW1iZXIsIHN0cmluZywgbnVtYmVyLCBzdHJpbmcsIHN0cmluZywgc3RyaW5nLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLFxyXG4gICAgbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXJcclxuXTtcclxuY2xhc3MgU3VtbWFyeVJvdyB7XHJcbiAgICBhcHByb3ZlZF9zdGF0dXM6IG51bWJlcjtcclxuICAgIGFwcHJvdmVkX2RhdGU6IHN0cmluZztcclxuICAgIG1vZGU6IG51bWJlcjtcclxuICAgIGJlYXRtYXBfaWQ6IHN0cmluZztcclxuICAgIGJlYXRtYXBzZXRfaWQ6IHN0cmluZztcclxuICAgIGRpc3BsYXlfc3RyaW5nOiBzdHJpbmc7XHJcbiAgICBkaXNwbGF5X3N0cmluZ19sb3dlcjogc3RyaW5nO1xyXG4gICAgc3RhcnM6IG51bWJlcjtcclxuICAgIHBwOiBudW1iZXI7XHJcbiAgICBoaXRfbGVuZ3RoOiBudW1iZXI7XHJcbiAgICBtYXhfY29tYm86IG51bWJlcjtcclxuICAgIGFwcHJvYWNoX3JhdGU6IG51bWJlcjtcclxuICAgIGNpcmNsZV9zaXplOiBudW1iZXI7XHJcbiAgICBtaW5fbWlzc2VzOiBudW1iZXI7XHJcbiAgICBmY05NOiBudW1iZXI7XHJcbiAgICBmY0hEOiBudW1iZXI7XHJcbiAgICBmY0hSOiBudW1iZXI7XHJcbiAgICBmY0hESFI6IG51bWJlcjtcclxuICAgIGZjRFQ6IG51bWJlcjtcclxuICAgIGZjSEREVDogbnVtYmVyO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBkYXRhOiBTdW1tYXJ5Um93RGF0YSkge1xyXG4gICAgICAgIFtcclxuICAgICAgICAgICAgdGhpcy5hcHByb3ZlZF9zdGF0dXMsXHJcbiAgICAgICAgICAgIHRoaXMuYXBwcm92ZWRfZGF0ZSxcclxuICAgICAgICAgICAgdGhpcy5tb2RlLFxyXG4gICAgICAgICAgICB0aGlzLmJlYXRtYXBfaWQsXHJcbiAgICAgICAgICAgIHRoaXMuYmVhdG1hcHNldF9pZCxcclxuICAgICAgICAgICAgdGhpcy5kaXNwbGF5X3N0cmluZyxcclxuICAgICAgICAgICAgdGhpcy5zdGFycyxcclxuICAgICAgICAgICAgdGhpcy5wcCxcclxuICAgICAgICAgICAgdGhpcy5oaXRfbGVuZ3RoLFxyXG4gICAgICAgICAgICB0aGlzLm1heF9jb21ibyxcclxuICAgICAgICAgICAgdGhpcy5hcHByb2FjaF9yYXRlLFxyXG4gICAgICAgICAgICB0aGlzLmNpcmNsZV9zaXplLFxyXG4gICAgICAgICAgICB0aGlzLm1pbl9taXNzZXMsXHJcbiAgICAgICAgICAgIHRoaXMuZmNOTSxcclxuICAgICAgICAgICAgdGhpcy5mY0hELFxyXG4gICAgICAgICAgICB0aGlzLmZjSFIsXHJcbiAgICAgICAgICAgIHRoaXMuZmNIREhSLFxyXG4gICAgICAgICAgICB0aGlzLmZjRFQsXHJcbiAgICAgICAgICAgIHRoaXMuZmNIRERULFxyXG4gICAgICAgIF0gPSBkYXRhO1xyXG4gICAgICAgIHRoaXMuZGlzcGxheV9zdHJpbmdfbG93ZXIgPSB0aGlzLmRpc3BsYXlfc3RyaW5nLnRvTG93ZXJDYXNlKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmxldCBzdW1tYXJ5Um93czogU3VtbWFyeVJvd1tdID0gW107XHJcbmxldCB1bnNvcnRlZFRhYmxlUm93czogSFRNTFRhYmxlUm93RWxlbWVudFtdID0gW107XHJcbmxldCBjdXJyZW50U29ydE9yZGVyOiBudW1iZXJbXSA9IFtdO1xyXG5sZXQgY3VycmVudEhhc2hMaW5rID0gJyMnO1xyXG5cclxubGV0IHByZXZpb3VzSW5kaWNlcyA9ICcnO1xyXG5mdW5jdGlvbiBkcmF3VGFibGUoaW5kaWNlczogbnVtYmVyW10pIHtcclxuICAgIGNvbnN0IHN0ciA9IGluZGljZXMuam9pbignLCcpO1xyXG4gICAgaWYgKHByZXZpb3VzSW5kaWNlcyA9PT0gc3RyKSByZXR1cm47XHJcbiAgICBwcmV2aW91c0luZGljZXMgPSBzdHI7XHJcbiAgICAkKCcjc3VtbWFyeS10YWJsZSA+IHRib2R5JylcclxuICAgICAgICAuaHRtbCgnJylcclxuICAgICAgICAuYXBwZW5kKGluZGljZXMubWFwKGluZGV4ID0+IHVuc29ydGVkVGFibGVSb3dzW2luZGV4XSkpO1xyXG59XHJcblxyXG5jbGFzcyBTZWFyY2hRdWVyeSB7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgY2hlY2s6IChyb3c6IFN1bW1hcnlSb3cpID0+IGJvb2xlYW47XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgbm9ybWFsaXplZF9zb3VyY2U6IHN0cmluZztcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyByZWFkb25seSBzb3VyY2U6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGtleV90b19wcm9wZXJ0eV9uYW1lID0ge1xyXG4gICAgICAgICAgICAnc3RhdHVzJzogJ2FwcHJvdmVkX3N0YXR1cycsXHJcbiAgICAgICAgICAgICdtb2RlJzogJ21vZGUnLFxyXG4gICAgICAgICAgICAnc3RhcnMnOiAnc3RhcnMnLFxyXG4gICAgICAgICAgICAncHAnOiAncHAnLFxyXG4gICAgICAgICAgICAnbGVuZ3RoJzogJ2hpdF9sZW5ndGgnLFxyXG4gICAgICAgICAgICAnY29tYm8nOiAnbWF4X2NvbWJvJyxcclxuICAgICAgICAgICAgJ2FyJzogJ2FwcHJvYWNoX3JhdGUnLFxyXG4gICAgICAgICAgICAnY3MnOiAnY2lyY2xlX3NpemUnLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgbGV0IGNoZWNrX2Z1bmNfc291cmNlID0gJ3JldHVybiB0cnVlJztcclxuICAgICAgICB0aGlzLm5vcm1hbGl6ZWRfc291cmNlID0gJyc7XHJcbiAgICAgICAgZm9yIChjb25zdCB0b2tlbiBvZiBzb3VyY2Uuc3BsaXQoJyAnKSkge1xyXG4gICAgICAgICAgICBjb25zdCB0cmltbWVkID0gdG9rZW4udHJpbSgpO1xyXG4gICAgICAgICAgICBpZiAodHJpbW1lZCA9PT0gJycpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9XHJcbiAgICAgICAgICAgICAgICAvKHN0YXR1c3xtb2RlfHN0YXJzfHBwfGxlbmd0aHxjb21ib3xhcnxjcykoPHw8PXw+fD49fD18IT0pKFstXFxkXFwuXSspLy5leGVjKHRyaW1tZWQpO1xyXG4gICAgICAgICAgICBpZiAobWF0Y2gpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IG1hdGNoWzFdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVsID0gbWF0Y2hbMl0gPT09ICc9JyA/ICc9PScgOiBtYXRjaFsyXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IHBhcnNlRmxvYXQobWF0Y2hbM10pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzTmFOKHZhbCkpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcHJvcCA9IChrZXlfdG9fcHJvcGVydHlfbmFtZSBhcyBhbnkpW2tleV07XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ub3JtYWxpemVkX3NvdXJjZSAhPT0gJycpIHRoaXMubm9ybWFsaXplZF9zb3VyY2UgKz0gJyAnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ub3JtYWxpemVkX3NvdXJjZSArPSBtYXRjaFsxXSArIG1hdGNoWzJdICsgbWF0Y2hbM107XHJcbiAgICAgICAgICAgICAgICBjaGVja19mdW5jX3NvdXJjZSArPSBgJiZyb3cuJHtwcm9wfSR7cmVsfSR7dmFsfWA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdHIgPSB0cmltbWVkLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBlc2NhcGVkID0gSlNPTi5zdHJpbmdpZnkoc3RyKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vcm1hbGl6ZWRfc291cmNlICE9PSAnJykgdGhpcy5ub3JtYWxpemVkX3NvdXJjZSArPSAnICc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vcm1hbGl6ZWRfc291cmNlICs9IHN0cjtcclxuICAgICAgICAgICAgICAgIGNoZWNrX2Z1bmNfc291cmNlICs9IGAmJnJvdy5kaXNwbGF5X3N0cmluZ19sb3dlci5pbmRleE9mKCR7ZXNjYXBlZH0pIT09LTFgO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2hlY2sgPSBuZXcgRnVuY3Rpb24oJ3JvdycsIGNoZWNrX2Z1bmNfc291cmNlKSBhcyBhbnk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IHNvcnRLZXlzID0gW1xyXG4gICAgKHg6IFN1bW1hcnlSb3cpID0+IHguYXBwcm92ZWRfZGF0ZSxcclxuICAgICh4OiBTdW1tYXJ5Um93KSA9PiB4LmRpc3BsYXlfc3RyaW5nLFxyXG4gICAgKHg6IFN1bW1hcnlSb3cpID0+IHguc3RhcnMsXHJcbiAgICAoeDogU3VtbWFyeVJvdykgPT4geC5wcCxcclxuICAgICh4OiBTdW1tYXJ5Um93KSA9PiB4LmhpdF9sZW5ndGgsXHJcbiAgICAoeDogU3VtbWFyeVJvdykgPT4geC5tYXhfY29tYm8sXHJcbiAgICAoeDogU3VtbWFyeVJvdykgPT4geC5hcHByb2FjaF9yYXRlLFxyXG4gICAgKHg6IFN1bW1hcnlSb3cpID0+IHguY2lyY2xlX3NpemUsXHJcbiAgICAoeDogU3VtbWFyeVJvdykgPT5cclxuICAgICAgICB4LmZjSEREVCAqIDIgKyB4LmZjRFQgKiAxZTggK1xyXG4gICAgICAgIHguZmNIREhSICogMiArIHguZmNIUiAqIDFlNCArXHJcbiAgICAgICAgeC5mY0hEICogMiArIHguZmNOTSAtXHJcbiAgICAgICAgeC5taW5fbWlzc2VzLFxyXG5dO1xyXG5cclxuZnVuY3Rpb24gc3RyaW5naWZ5T2JqZWN0KG9iajogeyBba2V5OiBzdHJpbmddOiBzdHJpbmc7IH0pOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iailcclxuICAgICAgICAubWFwKGsgPT4gayArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChvYmpba10pKVxyXG4gICAgICAgIC5qb2luKCcmJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBhcnNlT2JqZWN0KHN0cjogc3RyaW5nKSB7XHJcbiAgICBjb25zdCByZXMgPSB7fTtcclxuICAgIHN0ci5zcGxpdCgnJicpLmZvckVhY2gocGFydCA9PiB7XHJcbiAgICAgICAgY29uc3QgbWF0Y2ggPSBwYXJ0Lm1hdGNoKC8oXFx3Kyk9KC4rKS8pO1xyXG4gICAgICAgIGlmIChtYXRjaClcclxuICAgICAgICAgICAgKHJlcyBhcyBhbnkpW21hdGNoWzFdXSA9IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaFsyXSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGRyYXdUYWJsZUZvckN1cnJlbnRGaWx0ZXJpbmcoKSB7XHJcbiAgICBjb25zdCBmaWx0ZXJfYXBwcm92ZWRfc3RhdHVzID0gcGFyc2VJbnQoJCgnKltuYW1lPVwiZmlsdGVyX2FwcHJvdmVkX3N0YXR1c1wiXScpLnZhbCgpIGFzIHN0cmluZyk7XHJcbiAgICBjb25zdCBmaWx0ZXJfbW9kZSA9IHBhcnNlSW50KCQoJypbbmFtZT1cImZpbHRlcl9tb2RlXCJdJykudmFsKCkgYXMgc3RyaW5nKTtcclxuICAgIGNvbnN0IGZpbHRlcl9zZWFyY2hfcXVlcnkgPSBuZXcgU2VhcmNoUXVlcnkoKCQoJypbbmFtZT1cImZpbHRlcl9zZWFyY2hfcXVlcnlcIl0nKS52YWwoKSBhcyBzdHJpbmcpKTtcclxuICAgIGNvbnN0IGZpbHRlcl9mY19sZXZlbCA9IHBhcnNlSW50KCQoJypbbmFtZT1cImZpbHRlcl9mY19sZXZlbFwiXScpLnZhbCgpIGFzIHN0cmluZyk7XHJcblxyXG4gICAgY29uc3QgZ2V0X2ZjX2xldmVsID0gKHJvdzogU3VtbWFyeVJvdykgPT4ge1xyXG4gICAgICAgIGlmIChyb3cubWluX21pc3NlcyAhPT0gMCkgcmV0dXJuIDE7XHJcbiAgICAgICAgaWYgKHJvdy5mY0RUICE9PSAwIHx8IHJvdy5mY0hERFQgIT09IDApIHJldHVybiA4O1xyXG4gICAgICAgIGlmIChyb3cuZmNOTSA9PT0gMCAmJiByb3cuZmNIRCA9PT0gMCAmJiByb3cuZmNIUiA9PT0gMCAmJiByb3cuZmNIREhSID09PSAwKSByZXR1cm4gMjtcclxuICAgICAgICBpZiAocm93LmZjTk0gPT09IDAgJiYgcm93LmZjSEQgPT09IDApIHJldHVybiAzO1xyXG4gICAgICAgIGlmIChyb3cuZmNIRCA9PT0gMCkgcmV0dXJuIDQ7XHJcbiAgICAgICAgaWYgKHJvdy5mY0hSID09PSAwICYmIHJvdy5mY0hESFIgPT09IDApIHJldHVybiA1O1xyXG4gICAgICAgIGlmIChyb3cuZmNIREhSID09PSAwKSByZXR1cm4gNjtcclxuICAgICAgICByZXR1cm4gNztcclxuICAgIH07XHJcblxyXG4gICAgY3VycmVudEhhc2hMaW5rID0gJyMnO1xyXG4gICAgY29uc3Qgb2JqID0ge30gYXMgeyBba2V5OiBzdHJpbmddOiBzdHJpbmc7IH07XHJcbiAgICBpZiAoZmlsdGVyX2FwcHJvdmVkX3N0YXR1cyAhPT0gMSlcclxuICAgICAgICBvYmoucyA9IGZpbHRlcl9hcHByb3ZlZF9zdGF0dXMudG9TdHJpbmcoKTtcclxuICAgIGlmIChmaWx0ZXJfbW9kZSAhPT0gMSlcclxuICAgICAgICBvYmoubSA9IGZpbHRlcl9tb2RlLnRvU3RyaW5nKCk7XHJcbiAgICBpZiAoZmlsdGVyX3NlYXJjaF9xdWVyeS5ub3JtYWxpemVkX3NvdXJjZSAhPT0gJycpXHJcbiAgICAgICAgb2JqLnEgPSBmaWx0ZXJfc2VhcmNoX3F1ZXJ5Lm5vcm1hbGl6ZWRfc291cmNlO1xyXG4gICAgaWYgKGZpbHRlcl9mY19sZXZlbCAhPT0gMClcclxuICAgICAgICBvYmoubCA9IGZpbHRlcl9mY19sZXZlbC50b1N0cmluZygpO1xyXG4gICAgaWYgKGN1cnJlbnRTb3J0T3JkZXIubGVuZ3RoICE9PSAwKVxyXG4gICAgICAgIG9iai5vID0gY3VycmVudFNvcnRPcmRlci5qb2luKCcuJyk7XHJcblxyXG4gICAgY3VycmVudEhhc2hMaW5rICs9IHN0cmluZ2lmeU9iamVjdChvYmopO1xyXG4gICAgaWYgKGN1cnJlbnRIYXNoTGluayA9PT0gJyMnKVxyXG4gICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCBkb2N1bWVudC50aXRsZSwgbG9jYXRpb24ucGF0aG5hbWUpO1xyXG4gICAgZWxzZVxyXG4gICAgICAgIGxvY2F0aW9uLmhhc2ggPSBjdXJyZW50SGFzaExpbms7XHJcblxyXG4gICAgY29uc3QgaW5kaWNlcyA9IHN1bW1hcnlSb3dzLm1hcCgoXywgaW5kZXgpID0+IGluZGV4KS5maWx0ZXIoaW5kZXggPT4ge1xyXG4gICAgICAgIGNvbnN0IHJvdyA9IHN1bW1hcnlSb3dzW2luZGV4XTtcclxuXHJcbiAgICAgICAgaWYgKGZpbHRlcl9hcHByb3ZlZF9zdGF0dXMgPT09IDEgJiZcclxuICAgICAgICAgICAgKHJvdy5hcHByb3ZlZF9zdGF0dXMgIT09IDEgJiYgcm93LmFwcHJvdmVkX3N0YXR1cyAhPT0gMikpXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICBpZiAoZmlsdGVyX2FwcHJvdmVkX3N0YXR1cyA9PT0gMiAmJiByb3cuYXBwcm92ZWRfc3RhdHVzICE9PSA0KVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmIChmaWx0ZXJfbW9kZSA9PT0gMSAmJiByb3cubW9kZSAhPT0gMClcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIGlmIChmaWx0ZXJfbW9kZSA9PT0gMiAmJiByb3cubW9kZSAhPT0gMilcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICBpZiAoIWZpbHRlcl9zZWFyY2hfcXVlcnkuY2hlY2socm93KSlcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICBpZiAoZmlsdGVyX2ZjX2xldmVsICE9PSAwICYmIGdldF9mY19sZXZlbChyb3cpICE9PSBmaWx0ZXJfZmNfbGV2ZWwpXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IG9yZCBvZiBjdXJyZW50U29ydE9yZGVyKSB7XHJcbiAgICAgICAgaWYgKG9yZCA9PT0gMCkgY29udGludWU7XHJcbiAgICAgICAgY29uc3QgcHJldkluZGV4ID0gQXJyYXkoaW5kaWNlcy5sZW5ndGgpO1xyXG4gICAgICAgIGluZGljZXMuZm9yRWFjaCgoeCwgaSkgPT4gcHJldkluZGV4W3hdID0gaSk7XHJcbiAgICAgICAgY29uc3Qgc29ydEtleSA9IHNvcnRLZXlzW01hdGguYWJzKG9yZCkgLSAxXTtcclxuICAgICAgICBjb25zdCBzaWduID0gb3JkID4gMCA/IDEgOiAtMTtcclxuICAgICAgICBpbmRpY2VzLnNvcnQoKHgsIHkpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qga3ggPSBzb3J0S2V5KHN1bW1hcnlSb3dzW3hdKTtcclxuICAgICAgICAgICAgY29uc3Qga3kgPSBzb3J0S2V5KHN1bW1hcnlSb3dzW3ldKTtcclxuICAgICAgICAgICAgcmV0dXJuIGt4IDwga3kgPyAtc2lnbiA6IGt4ID4ga3kgPyBzaWduIDogcHJldkluZGV4W3ldIC0gcHJldkluZGV4W3hdO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgICQoJyNoYXNoLWxpbmstdG8tdGhlLWN1cnJlbnQtdGFibGUnKS5hdHRyKCdocmVmJywgY3VycmVudEhhc2hMaW5rKTtcclxuXHJcbiAgICBkcmF3VGFibGUoaW5kaWNlcyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNpbXBseVNvcnRPcmRlcihvcmRlcjogbnVtYmVyW10pOiBudW1iZXJbXSB7XHJcbiAgICBjb25zdCByZXMgPSBbXTtcclxuICAgIGNvbnN0IHNlZW4gPSBBcnJheShzb3J0S2V5cy5sZW5ndGgpO1xyXG4gICAgZm9yIChsZXQgaSA9IG9yZGVyLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS0gaSkge1xyXG4gICAgICAgIGNvbnN0IHggPSBvcmRlcltpXTtcclxuICAgICAgICBpZiAoeCA9PT0gMCkgY29udGludWU7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gTWF0aC5hYnMoeCkgLSAxLCBzaWduID0geCA+IDAgPyAxIDogLTE7XHJcbiAgICAgICAgaWYgKHNlZW5ba2V5XSkgY29udGludWU7XHJcbiAgICAgICAgc2VlbltrZXldID0gc2lnbjtcclxuICAgICAgICByZXMucHVzaCh4KTtcclxuICAgICAgICBpZiAoWzAsIDEsIDIsIDMsIDQsIDVdLmluZGV4T2Yoa2V5KSAhPT0gLTEpIC8vIHRoZXJlIGlzIGFsbW9zdCBubyB0aWVzXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlcy5sZW5ndGggIT09IDAgJiYgcmVzW3Jlcy5sZW5ndGggLSAxXSA9PT0gLTMpXHJcbiAgICAgICAgcmVzLnBvcCgpO1xyXG4gICAgcmVzLnJldmVyc2UoKTtcclxuICAgIHJldHVybiByZXM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldFF1ZXJ5QWNjb3JkaW5nVG9IYXNoKCkge1xyXG4gICAgbGV0IG9iajogeyBbazogc3RyaW5nXTogc3RyaW5nOyB9O1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBvYmogPSBwYXJzZU9iamVjdChsb2NhdGlvbi5oYXNoLnN1YnN0cigxKSk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgb2JqID0ge307XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mKG9iai5zKSA9PT0gJ3VuZGVmaW5lZCcpIG9iai5zID0gJzEnO1xyXG4gICAgaWYgKHR5cGVvZihvYmoubSkgPT09ICd1bmRlZmluZWQnKSBvYmoubSA9ICcxJztcclxuICAgIGlmICh0eXBlb2Yob2JqLnEpID09PSAndW5kZWZpbmVkJykgb2JqLnEgPSAnJztcclxuICAgIGlmICh0eXBlb2Yob2JqLmwpID09PSAndW5kZWZpbmVkJykgb2JqLmwgPSAnMCc7XHJcbiAgICBpZiAodHlwZW9mKG9iai5vKSA9PT0gJ3VuZGVmaW5lZCcpIG9iai5vID0gJyc7XHJcbiAgICAkKCcqW25hbWU9XCJmaWx0ZXJfYXBwcm92ZWRfc3RhdHVzXCJdJykudmFsKHBhcnNlSW50KG9iai5zKSk7XHJcbiAgICAkKCcqW25hbWU9XCJmaWx0ZXJfbW9kZVwiXScpLnZhbChwYXJzZUludChvYmoubSkpO1xyXG4gICAgJCgnKltuYW1lPVwiZmlsdGVyX3NlYXJjaF9xdWVyeVwiXScpLnZhbChvYmoucSk7XHJcbiAgICAkKCcqW25hbWU9XCJmaWx0ZXJfZmNfbGV2ZWxcIl0nKS52YWwocGFyc2VJbnQob2JqLmwpKTtcclxuICAgIGN1cnJlbnRTb3J0T3JkZXIgPSBzaW1wbHlTb3J0T3JkZXIob2JqLm8uc3BsaXQoJy4nKS5tYXAoeCA9PiBwYXJzZUludCh4KSB8fCAwKSk7XHJcbiAgICBzZXRUYWJsZUhlYWRTb3J0aW5nTWFyaygpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRUYWJsZUhlYWRTb3J0aW5nTWFyaygpIHtcclxuICAgICQoJy5zb3J0ZWQnKS5yZW1vdmVDbGFzcygnc29ydGVkIGFzY2VuZGluZyBkZXNjZW5kaW5nJyk7XHJcbiAgICBjb25zdCB4ID0gY3VycmVudFNvcnRPcmRlci5sZW5ndGggPT09IDAgP1xyXG4gICAgICAgIC0zIDogLy8gc3RhcnMgZGVzY1xyXG4gICAgICAgIGN1cnJlbnRTb3J0T3JkZXJbY3VycmVudFNvcnRPcmRlci5sZW5ndGggLSAxXTtcclxuICAgIGNvbnN0IGluZGV4ID0gTWF0aC5hYnMoeCkgLSAxO1xyXG4gICAgJCgkKCcjc3VtbWFyeS10YWJsZSA+IHRoZWFkID4gdHIgPiB0aCcpW2luZGV4XSlcclxuICAgICAgICAuYWRkQ2xhc3MoJ3NvcnRlZCcpLmFkZENsYXNzKHggPiAwID8gJ2FzY2VuZGluZycgOiAnZGVzY2VuZGluZycpO1xyXG59XHJcblxyXG4kKCgpID0+IHtcclxuICAgIHNldFF1ZXJ5QWNjb3JkaW5nVG9IYXNoKCk7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsICgpID0+IHtcclxuICAgICAgICBzZXRRdWVyeUFjY29yZGluZ1RvSGFzaCgpO1xyXG4gICAgICAgIGRyYXdUYWJsZUZvckN1cnJlbnRGaWx0ZXJpbmcoKTtcclxuICAgIH0pO1xyXG4gICAgY29uc3Qgb25DaGFuZ2UgPSAoKSA9PiB7XHJcbiAgICAgICAgZHJhd1RhYmxlRm9yQ3VycmVudEZpbHRlcmluZygpO1xyXG4gICAgfTtcclxuICAgIGZvciAoY29uc3QgbmFtZSBvZiBbJ2ZpbHRlcl9hcHByb3ZlZF9zdGF0dXMnLCAnZmlsdGVyX21vZGUnLCAnZmlsdGVyX2ZjX2xldmVsJ10pXHJcbiAgICAgICAgJChgc2VsZWN0W25hbWU9XCIke25hbWV9XCJdYCkub24oJ2NoYW5nZScsIG9uQ2hhbmdlKTtcclxuICAgIGZvciAoY29uc3QgbmFtZSBvZiBbJ2ZpbHRlcl9zZWFyY2hfcXVlcnknXSlcclxuICAgICAgICAkKGBpbnB1dFtuYW1lPVwiJHtuYW1lfVwiXWApLm9uKCdpbnB1dCcsIG9uQ2hhbmdlKTtcclxuXHJcbiAgICBjb25zdCB0aExpc3QgPSAkKCcjc3VtbWFyeS10YWJsZSA+IHRoZWFkID4gdHIgPiB0aCcpO1xyXG4gICAgc29ydEtleXMuZm9yRWFjaCgoXywgaW5kZXgpID0+IHtcclxuICAgICAgICAkLmRhdGEodGhMaXN0W2luZGV4XSwgJ3RoSW5kZXgnLCBpbmRleCk7XHJcbiAgICB9KTtcclxuICAgICQuZ2V0SlNPTignZGF0YS9zdW1tYXJ5Lmpzb24nKS50aGVuKChkYXRhOiBTdW1tYXJ5Um93RGF0YVtdLCBfLCB4aHIpID0+IHtcclxuICAgICAgICBjb25zdCBsYXN0X21vZGlmaWVkID0gbmV3IERhdGUoeGhyLmdldFJlc3BvbnNlSGVhZGVyKCdMYXN0LU1vZGlmaWVkJykgYXMgc3RyaW5nKTtcclxuICAgICAgICAkKCcjbGFzdC11cGRhdGUtdGltZScpXHJcbiAgICAgICAgICAgIC5hdHRyKCdkYXRldGltZScsIGxhc3RfbW9kaWZpZWQudG9JU09TdHJpbmcoKSlcclxuICAgICAgICAgICAgLnRleHQobGFzdF9tb2RpZmllZC50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0pO1xyXG4gICAgICAgIGNvbnN0IHBhZCA9ICh4OiBudW1iZXIpID0+ICh4IDwgMTAgPyAnMCcgOiAnJykgKyB4O1xyXG4gICAgICAgIGNvbnN0IG1vZGVfaWNvbnMgPSBbXHJcbiAgICAgICAgICAgICdleGNoYW5nZSBpY29uJyxcclxuICAgICAgICAgICAgJycsXHJcbiAgICAgICAgICAgICd0aGVtZSBpY29uJyxcclxuICAgICAgICAgICAgJycsXHJcbiAgICAgICAgXTtcclxuICAgICAgICBjb25zdCBhcHByb3ZlZF9zdGF0dXNfaWNvbnMgPSBbXHJcbiAgICAgICAgICAgICdoZWxwIGljb24nLFxyXG4gICAgICAgICAgICAnYW5nbGUgZG91YmxlIHVwIGljb24nLFxyXG4gICAgICAgICAgICAnZmlyZSBpY29uJyxcclxuICAgICAgICAgICAgJ2NoZWNrbWFyayBpY29uJyxcclxuICAgICAgICAgICAgJ2VtcHR5IGhlYXJ0IGljb24nLFxyXG4gICAgICAgIF07XHJcbiAgICAgICAgc3VtbWFyeVJvd3MgPSBkYXRhLm1hcCh4ID0+IG5ldyBTdW1tYXJ5Um93KHgpKTtcclxuICAgICAgICB1bnNvcnRlZFRhYmxlUm93cyA9IHN1bW1hcnlSb3dzLm1hcChyb3cgPT5cclxuICAgICAgICAgICAgJCgnPHRyPicpLmFwcGVuZChbXHJcbiAgICAgICAgICAgICAgICBbXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnPGk+JykuYWRkQ2xhc3MoYXBwcm92ZWRfc3RhdHVzX2ljb25zW3Jvdy5hcHByb3ZlZF9zdGF0dXNdKSxcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShyb3cuYXBwcm92ZWRfZGF0ZS5zcGxpdCgnICcpWzBdKVxyXG4gICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgIFtcclxuICAgICAgICAgICAgICAgICAgICAkKCc8aT4nKS5hZGRDbGFzcyhtb2RlX2ljb25zW3Jvdy5tb2RlXSksXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnPGE+JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2hyZWYnLCBgaHR0cHM6Ly9vc3UucHB5LnNoL2IvJHtyb3cuYmVhdG1hcF9pZH0/bT0yYClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQocm93LmRpc3BsYXlfc3RyaW5nKSxcclxuICAgICAgICAgICAgICAgICAgICAkKCc8ZGl2IHN0eWxlPVwiZmxvYXQ6cmlnaHRcIj4nKS5hcHBlbmQoW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCc8YT48aSBjbGFzcz1cImltYWdlIGljb25cIj4nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2hyZWYnLCBgaHR0cHM6Ly9iLnBweS5zaC90aHVtYi8ke3Jvdy5iZWF0bWFwc2V0X2lkfS5qcGdgKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnPGE+PGkgY2xhc3M9XCJkb3dubG9hZCBpY29uXCI+JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdocmVmJywgYGh0dHBzOi8vb3N1LnBweS5zaC9kLyR7cm93LmJlYXRtYXBzZXRfaWR9bmApXHJcbiAgICAgICAgICAgICAgICAgICAgXSlcclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICByb3cuc3RhcnMudG9GaXhlZCgyKSxcclxuICAgICAgICAgICAgICAgIHJvdy5wcC50b0ZpeGVkKDApLFxyXG4gICAgICAgICAgICAgICAgYCR7TWF0aC5mbG9vcihyb3cuaGl0X2xlbmd0aCAvIDYwKX06JHtwYWQoTWF0aC5mbG9vcihyb3cuaGl0X2xlbmd0aCAlIDYwKSl9YCxcclxuICAgICAgICAgICAgICAgIHJvdy5tYXhfY29tYm8udG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgIHJvdy5hcHByb2FjaF9yYXRlLnRvRml4ZWQoMSksXHJcbiAgICAgICAgICAgICAgICByb3cuY2lyY2xlX3NpemUudG9GaXhlZCgxKSxcclxuICAgICAgICAgICAgICAgICAgICByb3cubWluX21pc3NlcyAhPT0gMCA/IChyb3cubWluX21pc3NlcyA9PT0gMSA/ICcxIG1pc3MnIDogcm93Lm1pbl9taXNzZXMgKyAnIG1pc3NlcycpIDpcclxuICAgICAgICAgICAgICAgICAgICBbcm93LmZjTk0sIHJvdy5mY0hELCByb3cuZmNIUiwgcm93LmZjSERIUiwgcm93LmZjRFQsIHJvdy5mY0hERFRdLmpvaW4oJywgJylcclxuICAgICAgICAgICAgXS5tYXAoeCA9PiAkKCc8dGQ+JykuYXBwZW5kKHgpKSlbMF0gYXMgSFRNTFRhYmxlUm93RWxlbWVudCk7XHJcbiAgICAgICAgZHJhd1RhYmxlRm9yQ3VycmVudEZpbHRlcmluZygpO1xyXG4gICAgICAgICQoJyNzdW1tYXJ5LXRhYmxlLWxvYWRlcicpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgIH0pO1xyXG4gICAgdGhMaXN0LmNsaWNrKChldmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHRoID0gJChldmVudC50YXJnZXQpO1xyXG4gICAgICAgIGxldCBzaWduO1xyXG4gICAgICAgIGlmICh0aC5oYXNDbGFzcygnc29ydGVkJykpXHJcbiAgICAgICAgICAgIHNpZ24gPSB0aC5oYXNDbGFzcygnZGVzY2VuZGluZycpID8gMSA6IC0xO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgc2lnbiA9IHRoLmhhc0NsYXNzKCdkZXNjLWZpcnN0JykgPyAtMSA6IDE7XHJcbiAgICAgICAgY29uc3QgdGhJbmRleCA9IHRoLmRhdGEoJ3RoSW5kZXgnKSBhcyBudW1iZXI7XHJcbiAgICAgICAgY3VycmVudFNvcnRPcmRlci5wdXNoKCh0aEluZGV4ICsgMSkgKiBzaWduKTtcclxuICAgICAgICBjdXJyZW50U29ydE9yZGVyID0gc2ltcGx5U29ydE9yZGVyKGN1cnJlbnRTb3J0T3JkZXIpO1xyXG4gICAgICAgIHNldFRhYmxlSGVhZFNvcnRpbmdNYXJrKCk7XHJcbiAgICAgICAgZHJhd1RhYmxlRm9yQ3VycmVudEZpbHRlcmluZygpO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxufVxyXG4iXX0=