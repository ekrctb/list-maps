"use strict";
/// <reference types="jquery" />
var ListMaps;
(function (ListMaps) {
    var SummaryRow = /** @class */ (function () {
        function SummaryRow(data) {
            this.data = data;
            this.approved_status = data[0], this.approved_date = data[1], this.mode = data[2], this.beatmap_id = data[3], this.beatmapset_id = data[4], this.display_string = data[5], this.stars = data[6], this.pp = data[7], this.hit_length = data[8], this.max_combo = data[9], this.approach_rate = data[10], this.circle_size = data[11], this.min_misses = data[12], this.fcNM = data[13], this.fcHD = data[14], this.fcHR = data[15], this.fcHDHR = data[16], this.fcDT = data[17], this.fcHDDT = data[18];
            this.display_string_lower = this.display_string.toLowerCase();
        }
        return SummaryRow;
    }());
    var summaryRows = [];
    var unsortedTableRows = [];
    var currentSortOrder = [];
    var currentHashLink = '#';
    var previousIndices = '';
    function drawTable(indices) {
        var str = indices.join(',');
        if (previousIndices === str)
            return;
        previousIndices = str;
        $('#summary-table > tbody')
            .html('')
            .append(indices.map(function (index) { return unsortedTableRows[index]; }));
    }
    var SearchQuery = /** @class */ (function () {
        function SearchQuery(source) {
            this.source = source;
            var key_to_property_name = {
                'status': 'approved_status',
                'mode': 'mode',
                'stars': 'stars',
                'pp': 'pp',
                'length': 'hit_length',
                'combo': 'max_combo',
                'ar': 'approach_rate',
                'cs': 'circle_size',
            };
            var check_func_source = 'return true';
            this.normalized_source = '';
            for (var _i = 0, _a = source.split(' '); _i < _a.length; _i++) {
                var token = _a[_i];
                var trimmed = token.trim();
                if (trimmed === '')
                    continue;
                var match = /(status|mode|stars|pp|length|combo|ar|cs)(<|<=|>|>=|=|!=)([-\d\.]+)/.exec(trimmed);
                if (match) {
                    var key = match[1];
                    var rel = match[2] === '=' ? '==' : match[2];
                    var val = parseFloat(match[3]);
                    if (isNaN(val))
                        continue;
                    var prop = key_to_property_name[key];
                    if (this.normalized_source !== '')
                        this.normalized_source += ' ';
                    this.normalized_source += match[1] + match[2] + match[3];
                    check_func_source += "&&row." + prop + rel + val;
                }
                else {
                    var str = trimmed.toLowerCase();
                    var escaped = JSON.stringify(str);
                    if (this.normalized_source !== '')
                        this.normalized_source += ' ';
                    this.normalized_source += str;
                    check_func_source += "&&row.display_string_lower.indexOf(" + escaped + ")!==-1";
                }
            }
            this.check = new Function('row', check_func_source);
        }
        return SearchQuery;
    }());
    var sortKeys = [
        function (x) { return x.approved_date; },
        function (x) { return x.display_string; },
        function (x) { return x.stars; },
        function (x) { return x.pp; },
        function (x) { return x.hit_length; },
        function (x) { return x.max_combo; },
        function (x) { return x.approach_rate; },
        function (x) { return x.circle_size; },
        function (x) {
            return x.fcHDDT * 2 + x.fcDT * 1e8 +
                x.fcHDHR * 2 + x.fcHR * 1e4 +
                x.fcHD * 2 + x.fcNM -
                x.min_misses;
        },
    ];
    function stringifyObject(obj) {
        return Object.keys(obj)
            .map(function (k) { return k + '=' + encodeURIComponent(obj[k]); })
            .join('&');
    }
    function parseObject(str) {
        var res = {};
        str.split('&').forEach(function (part) {
            var match = part.match(/(\w+)=(.+)/);
            if (match)
                res[match[1]] = decodeURIComponent(match[2]);
        });
        return res;
    }
    function drawTableForCurrentFiltering() {
        var filter_approved_status = parseInt($('*[name="filter_approved_status"]').val());
        var filter_mode = parseInt($('*[name="filter_mode"]').val());
        var filter_search_query = new SearchQuery($('*[name="filter_search_query"]').val());
        var filter_fc_level = parseInt($('*[name="filter_fc_level"]').val());
        var get_fc_level = function (row) {
            if (row.min_misses !== 0)
                return 1;
            if (row.fcDT !== 0 || row.fcHDDT !== 0)
                return 8;
            if (row.fcNM === 0 && row.fcHD === 0 && row.fcHR === 0 && row.fcHDHR === 0)
                return 2;
            if (row.fcNM === 0 && row.fcHD === 0)
                return 3;
            if (row.fcHD === 0)
                return 4;
            if (row.fcHR === 0 && row.fcHDHR === 0)
                return 5;
            if (row.fcHDHR === 0)
                return 6;
            return 7;
        };
        currentHashLink = '#';
        var obj = {};
        if (filter_approved_status !== 1)
            obj.s = filter_approved_status.toString();
        if (filter_mode !== 1)
            obj.m = filter_mode.toString();
        if (filter_search_query.normalized_source !== '')
            obj.q = filter_search_query.normalized_source;
        if (filter_fc_level !== 0)
            obj.l = filter_fc_level.toString();
        if (currentSortOrder.length !== 0)
            obj.o = currentSortOrder.join('.');
        currentHashLink += stringifyObject(obj);
        if (currentHashLink === '#')
            history.replaceState({}, document.title, location.pathname);
        else
            location.hash = currentHashLink;
        var indices = summaryRows.map(function (_, index) { return index; }).filter(function (index) {
            var row = summaryRows[index];
            if (filter_approved_status === 1 &&
                (row.approved_status !== 1 && row.approved_status !== 2))
                return false;
            if (filter_approved_status === 2 && row.approved_status !== 4)
                return false;
            if (filter_mode === 1 && row.mode !== 0)
                return false;
            if (filter_mode === 2 && row.mode !== 2)
                return false;
            if (!filter_search_query.check(row))
                return false;
            if (filter_fc_level !== 0 && get_fc_level(row) !== filter_fc_level)
                return false;
            return true;
        });
        var _loop_1 = function (ord) {
            if (ord === 0)
                return "continue";
            var prevIndex = Array(indices.length);
            indices.forEach(function (x, i) { return prevIndex[x] = i; });
            var sortKey = sortKeys[Math.abs(ord) - 1];
            var sign = ord > 0 ? 1 : -1;
            indices.sort(function (x, y) {
                var kx = sortKey(summaryRows[x]);
                var ky = sortKey(summaryRows[y]);
                return kx < ky ? -sign : kx > ky ? sign : prevIndex[y] - prevIndex[x];
            });
        };
        for (var _i = 0, currentSortOrder_1 = currentSortOrder; _i < currentSortOrder_1.length; _i++) {
            var ord = currentSortOrder_1[_i];
            _loop_1(ord);
        }
        $('#hash-link-to-the-current-table').attr('href', currentHashLink);
        drawTable(indices);
    }
    function simplySortOrder(order) {
        var res = [];
        var seen = Array(sortKeys.length);
        for (var i = order.length - 1; i >= 0; --i) {
            var x = order[i];
            if (x === 0)
                continue;
            var key = Math.abs(x) - 1, sign = x > 0 ? 1 : -1;
            if (seen[key])
                continue;
            seen[key] = sign;
            res.push(x);
            if ([0, 1, 2, 3, 4, 5].indexOf(key) !== -1)
                break;
        }
        if (res.length !== 0 && res[res.length - 1] === -3)
            res.pop();
        res.reverse();
        return res;
    }
    function setQueryAccordingToHash() {
        var obj;
        try {
            obj = parseObject(location.hash.substr(1));
        }
        catch (e) {
            obj = {};
        }
        if (typeof (obj.s) === 'undefined')
            obj.s = '1';
        if (typeof (obj.m) === 'undefined')
            obj.m = '1';
        if (typeof (obj.q) === 'undefined')
            obj.q = '';
        if (typeof (obj.l) === 'undefined')
            obj.l = '0';
        if (typeof (obj.o) === 'undefined')
            obj.o = '';
        $('*[name="filter_approved_status"]').val(parseInt(obj.s));
        $('*[name="filter_mode"]').val(parseInt(obj.m));
        $('*[name="filter_search_query"]').val(obj.q);
        $('*[name="filter_fc_level"]').val(parseInt(obj.l));
        currentSortOrder = simplySortOrder(obj.o.split('.').map(function (x) { return parseInt(x) || 0; }));
        setTableHeadSortingMark();
    }
    function setTableHeadSortingMark() {
        $('.sorted').removeClass('sorted ascending descending');
        var x = currentSortOrder.length === 0 ?
            -3 : // stars desc
            currentSortOrder[currentSortOrder.length - 1];
        var index = Math.abs(x) - 1;
        $($('#summary-table > thead > tr > th')[index])
            .addClass('sorted').addClass(x > 0 ? 'ascending' : 'descending');
    }
    $(function () {
        setQueryAccordingToHash();
        window.addEventListener('hashchange', function () {
            setQueryAccordingToHash();
            drawTableForCurrentFiltering();
        });
        var onChange = function () {
            drawTableForCurrentFiltering();
        };
        for (var _i = 0, _a = ['filter_approved_status', 'filter_mode', 'filter_fc_level']; _i < _a.length; _i++) {
            var name_1 = _a[_i];
            $("select[name=\"" + name_1 + "\"]").on('change', onChange);
        }
        for (var _b = 0, _c = ['filter_search_query']; _b < _c.length; _b++) {
            var name_2 = _c[_b];
            $("input[name=\"" + name_2 + "\"]").on('input', onChange);
        }
        var thList = $('#summary-table > thead > tr > th');
        sortKeys.forEach(function (_, index) {
            $.data(thList[index], 'thIndex', index);
        });
        $.getJSON('data/summary.json').then(function (data, _, xhr) {
            var last_modified = new Date(xhr.getResponseHeader('Last-Modified'));
            $('#last-update-time')
                .append($('<time>')
                .attr('datetime', last_modified.toISOString())
                .text(last_modified.toISOString().split('T')[0]));
            var pad = function (x) { return (x < 10 ? '0' : '') + x; };
            var mode_icons = [
                'exchange icon',
                '',
                'theme icon',
                '',
            ];
            var approved_status_icons = [
                'help icon',
                'angle double up icon',
                'fire icon',
                'checkmark icon',
                'empty heart icon',
            ];
            summaryRows = data.map(function (x) { return new SummaryRow(x); });
            unsortedTableRows = summaryRows.map(function (row) {
                return $('<tr>').append([
                    [
                        $('<i>').addClass(approved_status_icons[row.approved_status]),
                        document.createTextNode(row.approved_date.split(' ')[0])
                    ],
                    [
                        $('<i>').addClass(mode_icons[row.mode]),
                        $('<a>')
                            .attr('href', "https://osu.ppy.sh/b/" + row.beatmap_id + "?m=2")
                            .text(row.display_string),
                        $('<div style="float:right">').append([
                            $('<a><i class="image icon">')
                                .attr('href', "https://b.ppy.sh/thumb/" + row.beatmapset_id + ".jpg"),
                            $('<a><i class="download icon">')
                                .attr('href', "https://osu.ppy.sh/d/" + row.beatmapset_id + "n")
                        ])
                    ],
                    row.stars.toFixed(2),
                    row.pp.toFixed(0),
                    Math.floor(row.hit_length / 60) + ":" + pad(Math.floor(row.hit_length % 60)),
                    row.max_combo.toString(),
                    row.approach_rate.toFixed(1),
                    row.circle_size.toFixed(1),
                    row.min_misses !== 0 ? (row.min_misses === 1 ? '1 miss' : row.min_misses + ' misses') :
                        [row.fcNM, row.fcHD, row.fcHR, row.fcHDHR, row.fcDT, row.fcHDDT].join(', ')
                ].map(function (x) { return $('<td>').append(x); }))[0];
            });
            drawTableForCurrentFiltering();
            $('#summary-table-loader').removeClass('active');
        });
        thList.click(function (event) {
            var th = $(event.target);
            var sign;
            if (th.hasClass('sorted'))
                sign = th.hasClass('descending') ? 1 : -1;
            else
                sign = th.hasClass('desc-first') ? -1 : 1;
            var thIndex = th.data('thIndex');
            currentSortOrder.push((thIndex + 1) * sign);
            currentSortOrder = simplySortOrder(currentSortOrder);
            setTableHeadSortingMark();
            drawTableForCurrentFiltering();
        });
    });
})(ListMaps || (ListMaps = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1tYXBzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2xpc3QtbWFwcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsZ0NBQWdDO0FBQ2hDLElBQVUsUUFBUSxDQXlXakI7QUF6V0QsV0FBVSxRQUFRO0lBZWxCO1FBcUJJLG9CQUE2QixJQUFvQjtZQUFwQixTQUFJLEdBQUosSUFBSSxDQUFnQjtZQUV6Qyw4QkFBb0IsRUFDcEIsNEJBQWtCLEVBQ2xCLG1CQUFTLEVBQ1QseUJBQWUsRUFDZiw0QkFBa0IsRUFDbEIsNkJBQW1CLEVBQ25CLG9CQUFVLEVBQ1YsaUJBQU8sRUFDUCx5QkFBZSxFQUNmLHdCQUFjLEVBQ2QsNkJBQWtCLEVBQ2xCLDJCQUFnQixFQUNoQiwwQkFBZSxFQUNmLG9CQUFTLEVBQ1Qsb0JBQVMsRUFDVCxvQkFBUyxFQUNULHNCQUFXLEVBQ1gsb0JBQVMsRUFDVCxzQkFBVyxDQUNOO1lBQ1QsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbEUsQ0FBQztRQUNMLGlCQUFDO0lBQUQsQ0FBQyxBQTdDRCxJQTZDQztJQUVELElBQUksV0FBVyxHQUFpQixFQUFFLENBQUM7SUFDbkMsSUFBSSxpQkFBaUIsR0FBMEIsRUFBRSxDQUFDO0lBQ2xELElBQUksZ0JBQWdCLEdBQWEsRUFBRSxDQUFDO0lBQ3BDLElBQUksZUFBZSxHQUFHLEdBQUcsQ0FBQztJQUUxQixJQUFJLGVBQWUsR0FBRyxFQUFFLENBQUM7SUFDekIsbUJBQW1CLE9BQWlCO1FBQ2hDLElBQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUIsRUFBRSxDQUFDLENBQUMsZUFBZSxLQUFLLEdBQUcsQ0FBQztZQUFDLE1BQU0sQ0FBQztRQUNwQyxlQUFlLEdBQUcsR0FBRyxDQUFDO1FBQ3RCLENBQUMsQ0FBQyx3QkFBd0IsQ0FBQzthQUN0QixJQUFJ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QzNCLElBQUksSUFBSSxDQUFDO1lBQ1QsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDdEIsSUFBSSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUMsSUFBSTtnQkFDQSxJQUFJLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QyxJQUFNLE9BQU8sR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBVyxDQUFDO1lBQzdDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztZQUM1QyxnQkFBZ0IsR0FBRyxlQUFlLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUNyRCx1QkFBdUIsRUFBRSxDQUFDO1lBQzFCLDRCQUE0QixFQUFFLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUVILENBQUMsRUF6V1MsUUFBUSxLQUFSLFFBQVEsUUF5V2pCIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgdHlwZXM9XCJqcXVlcnlcIiAvPlxyXG5uYW1lc3BhY2UgTGlzdE1hcHMge1xyXG5cclxuaW50ZXJmYWNlIEpRdWVyeSB7XHJcbiAgICB0YWJsZXNvcnQoKTogdm9pZDtcclxuICAgIGRhdGEoa2V5OiAnc29ydEJ5Jywga2V5RnVuYzogKFxyXG4gICAgICAgIHRoOiBIVE1MVGFibGVIZWFkZXJDZWxsRWxlbWVudCxcclxuICAgICAgICB0ZDogSFRNTFRhYmxlRGF0YUNlbGxFbGVtZW50LFxyXG4gICAgICAgIHRhYmxlc29ydDogYW55KSA9PiB2b2lkKTogdGhpcztcclxufVxyXG5cclxudHlwZSBTdW1tYXJ5Um93RGF0YSA9XHJcbltcclxuICAgIG51bWJlciwgc3RyaW5nLCBudW1iZXIsIHN0cmluZywgc3RyaW5nLCBzdHJpbmcsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsXHJcbiAgICBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlclxyXG5dO1xyXG5jbGFzcyBTdW1tYXJ5Um93IHtcclxuICAgIGFwcHJvdmVkX3N0YXR1czogbnVtYmVyO1xyXG4gICAgYXBwcm92ZWRfZGF0ZTogc3RyaW5nO1xyXG4gICAgbW9kZTogbnVtYmVyO1xyXG4gICAgYmVhdG1hcF9pZDogc3RyaW5nO1xyXG4gICAgYmVhdG1hcHNldF9pZDogc3RyaW5nO1xyXG4gICAgZGlzcGxheV9zdHJpbmc6IHN0cmluZztcclxuICAgIGRpc3BsYXlfc3RyaW5nX2xvd2VyOiBzdHJpbmc7XHJcbiAgICBzdGFyczogbnVtYmVyO1xyXG4gICAgcHA6IG51bWJlcjtcclxuICAgIGhpdF9sZW5ndGg6IG51bWJlcjtcclxuICAgIG1heF9jb21ibzogbnVtYmVyO1xyXG4gICAgYXBwcm9hY2hfcmF0ZTogbnVtYmVyO1xyXG4gICAgY2lyY2xlX3NpemU6IG51bWJlcjtcclxuICAgIG1pbl9taXNzZXM6IG51bWJlcjtcclxuICAgIGZjTk06IG51bWJlcjtcclxuICAgIGZjSEQ6IG51bWJlcjtcclxuICAgIGZjSFI6IG51bWJlcjtcclxuICAgIGZjSERIUjogbnVtYmVyO1xyXG4gICAgZmNEVDogbnVtYmVyO1xyXG4gICAgZmNIRERUOiBudW1iZXI7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGRhdGE6IFN1bW1hcnlSb3dEYXRhKSB7XHJcbiAgICAgICAgW1xyXG4gICAgICAgICAgICB0aGlzLmFwcHJvdmVkX3N0YXR1cyxcclxuICAgICAgICAgICAgdGhpcy5hcHByb3ZlZF9kYXRlLFxyXG4gICAgICAgICAgICB0aGlzLm1vZGUsXHJcbiAgICAgICAgICAgIHRoaXMuYmVhdG1hcF9pZCxcclxuICAgICAgICAgICAgdGhpcy5iZWF0bWFwc2V0X2lkLFxyXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlfc3RyaW5nLFxyXG4gICAgICAgICAgICB0aGlzLnN0YXJzLFxyXG4gICAgICAgICAgICB0aGlzLnBwLFxyXG4gICAgICAgICAgICB0aGlzLmhpdF9sZW5ndGgsXHJcbiAgICAgICAgICAgIHRoaXMubWF4X2NvbWJvLFxyXG4gICAgICAgICAgICB0aGlzLmFwcHJvYWNoX3JhdGUsXHJcbiAgICAgICAgICAgIHRoaXMuY2lyY2xlX3NpemUsXHJcbiAgICAgICAgICAgIHRoaXMubWluX21pc3NlcyxcclxuICAgICAgICAgICAgdGhpcy5mY05NLFxyXG4gICAgICAgICAgICB0aGlzLmZjSEQsXHJcbiAgICAgICAgICAgIHRoaXMuZmNIUixcclxuICAgICAgICAgICAgdGhpcy5mY0hESFIsXHJcbiAgICAgICAgICAgIHRoaXMuZmNEVCxcclxuICAgICAgICAgICAgdGhpcy5mY0hERFQsXHJcbiAgICAgICAgXSA9IGRhdGE7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5X3N0cmluZ19sb3dlciA9IHRoaXMuZGlzcGxheV9zdHJpbmcudG9Mb3dlckNhc2UoKTtcclxuICAgIH1cclxufVxyXG5cclxubGV0IHN1bW1hcnlSb3dzOiBTdW1tYXJ5Um93W10gPSBbXTtcclxubGV0IHVuc29ydGVkVGFibGVSb3dzOiBIVE1MVGFibGVSb3dFbGVtZW50W10gPSBbXTtcclxubGV0IGN1cnJlbnRTb3J0T3JkZXI6IG51bWJlcltdID0gW107XHJcbmxldCBjdXJyZW50SGFzaExpbmsgPSAnIyc7XHJcblxyXG5sZXQgcHJldmlvdXNJbmRpY2VzID0gJyc7XHJcbmZ1bmN0aW9uIGRyYXdUYWJsZShpbmRpY2VzOiBudW1iZXJbXSkge1xyXG4gICAgY29uc3Qgc3RyID0gaW5kaWNlcy5qb2luKCcsJyk7XHJcbiAgICBpZiAocHJldmlvdXNJbmRpY2VzID09PSBzdHIpIHJldHVybjtcclxuICAgIHByZXZpb3VzSW5kaWNlcyA9IHN0cjtcclxuICAgICQoJyNzdW1tYXJ5LXRhYmxlID4gdGJvZHknKVxyXG4gICAgICAgIC5odG1sKCcnKVxyXG4gICAgICAgIC5hcHBlbmQoaW5kaWNlcy5tYXAoaW5kZXggPT4gdW5zb3J0ZWRUYWJsZVJvd3NbaW5kZXhdKSk7XHJcbn1cclxuXHJcbmNsYXNzIFNlYXJjaFF1ZXJ5IHtcclxuICAgIHB1YmxpYyByZWFkb25seSBjaGVjazogKHJvdzogU3VtbWFyeVJvdykgPT4gYm9vbGVhbjtcclxuICAgIHB1YmxpYyByZWFkb25seSBub3JtYWxpemVkX3NvdXJjZTogc3RyaW5nO1xyXG4gICAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IHNvdXJjZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qga2V5X3RvX3Byb3BlcnR5X25hbWUgPSB7XHJcbiAgICAgICAgICAgICdzdGF0dXMnOiAnYXBwcm92ZWRfc3RhdHVzJyxcclxuICAgICAgICAgICAgJ21vZGUnOiAnbW9kZScsXHJcbiAgICAgICAgICAgICdzdGFycyc6ICdzdGFycycsXHJcbiAgICAgICAgICAgICdwcCc6ICdwcCcsXHJcbiAgICAgICAgICAgICdsZW5ndGgnOiAnaGl0X2xlbmd0aCcsXHJcbiAgICAgICAgICAgICdjb21ibyc6ICdtYXhfY29tYm8nLFxyXG4gICAgICAgICAgICAnYXInOiAnYXBwcm9hY2hfcmF0ZScsXHJcbiAgICAgICAgICAgICdjcyc6ICdjaXJjbGVfc2l6ZScsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBsZXQgY2hlY2tfZnVuY19zb3VyY2UgPSAncmV0dXJuIHRydWUnO1xyXG4gICAgICAgIHRoaXMubm9ybWFsaXplZF9zb3VyY2UgPSAnJztcclxuICAgICAgICBmb3IgKGNvbnN0IHRva2VuIG9mIHNvdXJjZS5zcGxpdCgnICcpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSB0b2tlbi50cmltKCk7XHJcbiAgICAgICAgICAgIGlmICh0cmltbWVkID09PSAnJykgY29udGludWU7XHJcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID1cclxuICAgICAgICAgICAgICAgIC8oc3RhdHVzfG1vZGV8c3RhcnN8cHB8bGVuZ3RofGNvbWJvfGFyfGNzKSg8fDw9fD58Pj18PXwhPSkoWy1cXGRcXC5dKykvLmV4ZWModHJpbW1lZCk7XHJcbiAgICAgICAgICAgIGlmIChtYXRjaCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gbWF0Y2hbMV07XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZWwgPSBtYXRjaFsyXSA9PT0gJz0nID8gJz09JyA6IG1hdGNoWzJdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsID0gcGFyc2VGbG9hdChtYXRjaFszXSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4odmFsKSkgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9wID0gKGtleV90b19wcm9wZXJ0eV9uYW1lIGFzIGFueSlba2V5XTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vcm1hbGl6ZWRfc291cmNlICE9PSAnJykgdGhpcy5ub3JtYWxpemVkX3NvdXJjZSArPSAnICc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vcm1hbGl6ZWRfc291cmNlICs9IG1hdGNoWzFdICsgbWF0Y2hbMl0gKyBtYXRjaFszXTtcclxuICAgICAgICAgICAgICAgIGNoZWNrX2Z1bmNfc291cmNlICs9IGAmJnJvdy4ke3Byb3B9JHtyZWx9JHt2YWx9YDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0ciA9IHRyaW1tZWQudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVzY2FwZWQgPSBKU09OLnN0cmluZ2lmeShzdHIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubm9ybWFsaXplZF9zb3VyY2UgIT09ICcnKSB0aGlzLm5vcm1hbGl6ZWRfc291cmNlICs9ICcgJztcclxuICAgICAgICAgICAgICAgIHRoaXMubm9ybWFsaXplZF9zb3VyY2UgKz0gc3RyO1xyXG4gICAgICAgICAgICAgICAgY2hlY2tfZnVuY19zb3VyY2UgKz0gYCYmcm93LmRpc3BsYXlfc3RyaW5nX2xvd2VyLmluZGV4T2YoJHtlc2NhcGVkfSkhPT0tMWA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGVjayA9IG5ldyBGdW5jdGlvbigncm93JywgY2hlY2tfZnVuY19zb3VyY2UpIGFzIGFueTtcclxuICAgIH1cclxufVxyXG5cclxuY29uc3Qgc29ydEtleXMgPSBbXHJcbiAgICAoeDogU3VtbWFyeVJvdykgPT4geC5hcHByb3ZlZF9kYXRlLFxyXG4gICAgKHg6IFN1bW1hcnlSb3cpID0+IHguZGlzcGxheV9zdHJpbmcsXHJcbiAgICAoeDogU3VtbWFyeVJvdykgPT4geC5zdGFycyxcclxuICAgICh4OiBTdW1tYXJ5Um93KSA9PiB4LnBwLFxyXG4gICAgKHg6IFN1bW1hcnlSb3cpID0+IHguaGl0X2xlbmd0aCxcclxuICAgICh4OiBTdW1tYXJ5Um93KSA9PiB4Lm1heF9jb21ibyxcclxuICAgICh4OiBTdW1tYXJ5Um93KSA9PiB4LmFwcHJvYWNoX3JhdGUsXHJcbiAgICAoeDogU3VtbWFyeVJvdykgPT4geC5jaXJjbGVfc2l6ZSxcclxuICAgICh4OiBTdW1tYXJ5Um93KSA9PlxyXG4gICAgICAgIHguZmNIRERUICogMiArIHguZmNEVCAqIDFlOCArXHJcbiAgICAgICAgeC5mY0hESFIgKiAyICsgeC5mY0hSICogMWU0ICtcclxuICAgICAgICB4LmZjSEQgKiAyICsgeC5mY05NIC1cclxuICAgICAgICB4Lm1pbl9taXNzZXMsXHJcbl07XHJcblxyXG5mdW5jdGlvbiBzdHJpbmdpZnlPYmplY3Qob2JqOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZzsgfSk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqKVxyXG4gICAgICAgIC5tYXAoayA9PiBrICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KG9ialtrXSkpXHJcbiAgICAgICAgLmpvaW4oJyYnKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VPYmplY3Qoc3RyOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHJlcyA9IHt9O1xyXG4gICAgc3RyLnNwbGl0KCcmJykuZm9yRWFjaChwYXJ0ID0+IHtcclxuICAgICAgICBjb25zdCBtYXRjaCA9IHBhcnQubWF0Y2goLyhcXHcrKT0oLispLyk7XHJcbiAgICAgICAgaWYgKG1hdGNoKVxyXG4gICAgICAgICAgICAocmVzIGFzIGFueSlbbWF0Y2hbMV1dID0gZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoWzJdKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHJlcztcclxufVxyXG5cclxuZnVuY3Rpb24gZHJhd1RhYmxlRm9yQ3VycmVudEZpbHRlcmluZygpIHtcclxuICAgIGNvbnN0IGZpbHRlcl9hcHByb3ZlZF9zdGF0dXMgPSBwYXJzZUludCgkKCcqW25hbWU9XCJmaWx0ZXJfYXBwcm92ZWRfc3RhdHVzXCJdJykudmFsKCkgYXMgc3RyaW5nKTtcclxuICAgIGNvbnN0IGZpbHRlcl9tb2RlID0gcGFyc2VJbnQoJCgnKltuYW1lPVwiZmlsdGVyX21vZGVcIl0nKS52YWwoKSBhcyBzdHJpbmcpO1xyXG4gICAgY29uc3QgZmlsdGVyX3NlYXJjaF9xdWVyeSA9IG5ldyBTZWFyY2hRdWVyeSgoJCgnKltuYW1lPVwiZmlsdGVyX3NlYXJjaF9xdWVyeVwiXScpLnZhbCgpIGFzIHN0cmluZykpO1xyXG4gICAgY29uc3QgZmlsdGVyX2ZjX2xldmVsID0gcGFyc2VJbnQoJCgnKltuYW1lPVwiZmlsdGVyX2ZjX2xldmVsXCJdJykudmFsKCkgYXMgc3RyaW5nKTtcclxuXHJcbiAgICBjb25zdCBnZXRfZmNfbGV2ZWwgPSAocm93OiBTdW1tYXJ5Um93KSA9PiB7XHJcbiAgICAgICAgaWYgKHJvdy5taW5fbWlzc2VzICE9PSAwKSByZXR1cm4gMTtcclxuICAgICAgICBpZiAocm93LmZjRFQgIT09IDAgfHwgcm93LmZjSEREVCAhPT0gMCkgcmV0dXJuIDg7XHJcbiAgICAgICAgaWYgKHJvdy5mY05NID09PSAwICYmIHJvdy5mY0hEID09PSAwICYmIHJvdy5mY0hSID09PSAwICYmIHJvdy5mY0hESFIgPT09IDApIHJldHVybiAyO1xyXG4gICAgICAgIGlmIChyb3cuZmNOTSA9PT0gMCAmJiByb3cuZmNIRCA9PT0gMCkgcmV0dXJuIDM7XHJcbiAgICAgICAgaWYgKHJvdy5mY0hEID09PSAwKSByZXR1cm4gNDtcclxuICAgICAgICBpZiAocm93LmZjSFIgPT09IDAgJiYgcm93LmZjSERIUiA9PT0gMCkgcmV0dXJuIDU7XHJcbiAgICAgICAgaWYgKHJvdy5mY0hESFIgPT09IDApIHJldHVybiA2O1xyXG4gICAgICAgIHJldHVybiA3O1xyXG4gICAgfTtcclxuXHJcbiAgICBjdXJyZW50SGFzaExpbmsgPSAnIyc7XHJcbiAgICBjb25zdCBvYmogPSB7fSBhcyB7IFtrZXk6IHN0cmluZ106IHN0cmluZzsgfTtcclxuICAgIGlmIChmaWx0ZXJfYXBwcm92ZWRfc3RhdHVzICE9PSAxKVxyXG4gICAgICAgIG9iai5zID0gZmlsdGVyX2FwcHJvdmVkX3N0YXR1cy50b1N0cmluZygpO1xyXG4gICAgaWYgKGZpbHRlcl9tb2RlICE9PSAxKVxyXG4gICAgICAgIG9iai5tID0gZmlsdGVyX21vZGUudG9TdHJpbmcoKTtcclxuICAgIGlmIChmaWx0ZXJfc2VhcmNoX3F1ZXJ5Lm5vcm1hbGl6ZWRfc291cmNlICE9PSAnJylcclxuICAgICAgICBvYmoucSA9IGZpbHRlcl9zZWFyY2hfcXVlcnkubm9ybWFsaXplZF9zb3VyY2U7XHJcbiAgICBpZiAoZmlsdGVyX2ZjX2xldmVsICE9PSAwKVxyXG4gICAgICAgIG9iai5sID0gZmlsdGVyX2ZjX2xldmVsLnRvU3RyaW5nKCk7XHJcbiAgICBpZiAoY3VycmVudFNvcnRPcmRlci5sZW5ndGggIT09IDApXHJcbiAgICAgICAgb2JqLm8gPSBjdXJyZW50U29ydE9yZGVyLmpvaW4oJy4nKTtcclxuXHJcbiAgICBjdXJyZW50SGFzaExpbmsgKz0gc3RyaW5naWZ5T2JqZWN0KG9iaik7XHJcbiAgICBpZiAoY3VycmVudEhhc2hMaW5rID09PSAnIycpXHJcbiAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sIGRvY3VtZW50LnRpdGxlLCBsb2NhdGlvbi5wYXRobmFtZSk7XHJcbiAgICBlbHNlXHJcbiAgICAgICAgbG9jYXRpb24uaGFzaCA9IGN1cnJlbnRIYXNoTGluaztcclxuXHJcbiAgICBjb25zdCBpbmRpY2VzID0gc3VtbWFyeVJvd3MubWFwKChfLCBpbmRleCkgPT4gaW5kZXgpLmZpbHRlcihpbmRleCA9PiB7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gc3VtbWFyeVJvd3NbaW5kZXhdO1xyXG5cclxuICAgICAgICBpZiAoZmlsdGVyX2FwcHJvdmVkX3N0YXR1cyA9PT0gMSAmJlxyXG4gICAgICAgICAgICAocm93LmFwcHJvdmVkX3N0YXR1cyAhPT0gMSAmJiByb3cuYXBwcm92ZWRfc3RhdHVzICE9PSAyKSlcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIGlmIChmaWx0ZXJfYXBwcm92ZWRfc3RhdHVzID09PSAyICYmIHJvdy5hcHByb3ZlZF9zdGF0dXMgIT09IDQpXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgaWYgKGZpbHRlcl9tb2RlID09PSAxICYmIHJvdy5tb2RlICE9PSAwKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgaWYgKGZpbHRlcl9tb2RlID09PSAyICYmIHJvdy5tb2RlICE9PSAyKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmICghZmlsdGVyX3NlYXJjaF9xdWVyeS5jaGVjayhyb3cpKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmIChmaWx0ZXJfZmNfbGV2ZWwgIT09IDAgJiYgZ2V0X2ZjX2xldmVsKHJvdykgIT09IGZpbHRlcl9mY19sZXZlbClcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGZvciAoY29uc3Qgb3JkIG9mIGN1cnJlbnRTb3J0T3JkZXIpIHtcclxuICAgICAgICBpZiAob3JkID09PSAwKSBjb250aW51ZTtcclxuICAgICAgICBjb25zdCBwcmV2SW5kZXggPSBBcnJheShpbmRpY2VzLmxlbmd0aCk7XHJcbiAgICAgICAgaW5kaWNlcy5mb3JFYWNoKCh4LCBpKSA9PiBwcmV2SW5kZXhbeF0gPSBpKTtcclxuICAgICAgICBjb25zdCBzb3J0S2V5ID0gc29ydEtleXNbTWF0aC5hYnMob3JkKSAtIDFdO1xyXG4gICAgICAgIGNvbnN0IHNpZ24gPSBvcmQgPiAwID8gMSA6IC0xO1xyXG4gICAgICAgIGluZGljZXMuc29ydCgoeCwgeSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBreCA9IHNvcnRLZXkoc3VtbWFyeVJvd3NbeF0pO1xyXG4gICAgICAgICAgICBjb25zdCBreSA9IHNvcnRLZXkoc3VtbWFyeVJvd3NbeV0pO1xyXG4gICAgICAgICAgICByZXR1cm4ga3ggPCBreSA/IC1zaWduIDoga3ggPiBreSA/IHNpZ24gOiBwcmV2SW5kZXhbeV0gLSBwcmV2SW5kZXhbeF07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgJCgnI2hhc2gtbGluay10by10aGUtY3VycmVudC10YWJsZScpLmF0dHIoJ2hyZWYnLCBjdXJyZW50SGFzaExpbmspO1xyXG5cclxuICAgIGRyYXdUYWJsZShpbmRpY2VzKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2ltcGx5U29ydE9yZGVyKG9yZGVyOiBudW1iZXJbXSk6IG51bWJlcltdIHtcclxuICAgIGNvbnN0IHJlcyA9IFtdO1xyXG4gICAgY29uc3Qgc2VlbiA9IEFycmF5KHNvcnRLZXlzLmxlbmd0aCk7XHJcbiAgICBmb3IgKGxldCBpID0gb3JkZXIubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLSBpKSB7XHJcbiAgICAgICAgY29uc3QgeCA9IG9yZGVyW2ldO1xyXG4gICAgICAgIGlmICh4ID09PSAwKSBjb250aW51ZTtcclxuICAgICAgICBjb25zdCBrZXkgPSBNYXRoLmFicyh4KSAtIDEsIHNpZ24gPSB4ID4gMCA/IDEgOiAtMTtcclxuICAgICAgICBpZiAoc2VlbltrZXldKSBjb250aW51ZTtcclxuICAgICAgICBzZWVuW2tleV0gPSBzaWduO1xyXG4gICAgICAgIHJlcy5wdXNoKHgpO1xyXG4gICAgICAgIGlmIChbMCwgMSwgMiwgMywgNCwgNV0uaW5kZXhPZihrZXkpICE9PSAtMSkgLy8gdGhlcmUgaXMgYWxtb3N0IG5vIHRpZXNcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICBpZiAocmVzLmxlbmd0aCAhPT0gMCAmJiByZXNbcmVzLmxlbmd0aCAtIDFdID09PSAtMylcclxuICAgICAgICByZXMucG9wKCk7XHJcbiAgICByZXMucmV2ZXJzZSgpO1xyXG4gICAgcmV0dXJuIHJlcztcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0UXVlcnlBY2NvcmRpbmdUb0hhc2goKSB7XHJcbiAgICBsZXQgb2JqOiB7IFtrOiBzdHJpbmddOiBzdHJpbmc7IH07XHJcbiAgICB0cnkge1xyXG4gICAgICAgIG9iaiA9IHBhcnNlT2JqZWN0KGxvY2F0aW9uLmhhc2guc3Vic3RyKDEpKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICBvYmogPSB7fTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Yob2JqLnMpID09PSAndW5kZWZpbmVkJykgb2JqLnMgPSAnMSc7XHJcbiAgICBpZiAodHlwZW9mKG9iai5tKSA9PT0gJ3VuZGVmaW5lZCcpIG9iai5tID0gJzEnO1xyXG4gICAgaWYgKHR5cGVvZihvYmoucSkgPT09ICd1bmRlZmluZWQnKSBvYmoucSA9ICcnO1xyXG4gICAgaWYgKHR5cGVvZihvYmoubCkgPT09ICd1bmRlZmluZWQnKSBvYmoubCA9ICcwJztcclxuICAgIGlmICh0eXBlb2Yob2JqLm8pID09PSAndW5kZWZpbmVkJykgb2JqLm8gPSAnJztcclxuICAgICQoJypbbmFtZT1cImZpbHRlcl9hcHByb3ZlZF9zdGF0dXNcIl0nKS52YWwocGFyc2VJbnQob2JqLnMpKTtcclxuICAgICQoJypbbmFtZT1cImZpbHRlcl9tb2RlXCJdJykudmFsKHBhcnNlSW50KG9iai5tKSk7XHJcbiAgICAkKCcqW25hbWU9XCJmaWx0ZXJfc2VhcmNoX3F1ZXJ5XCJdJykudmFsKG9iai5xKTtcclxuICAgICQoJypbbmFtZT1cImZpbHRlcl9mY19sZXZlbFwiXScpLnZhbChwYXJzZUludChvYmoubCkpO1xyXG4gICAgY3VycmVudFNvcnRPcmRlciA9IHNpbXBseVNvcnRPcmRlcihvYmouby5zcGxpdCgnLicpLm1hcCh4ID0+IHBhcnNlSW50KHgpIHx8IDApKTtcclxuICAgIHNldFRhYmxlSGVhZFNvcnRpbmdNYXJrKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldFRhYmxlSGVhZFNvcnRpbmdNYXJrKCkge1xyXG4gICAgJCgnLnNvcnRlZCcpLnJlbW92ZUNsYXNzKCdzb3J0ZWQgYXNjZW5kaW5nIGRlc2NlbmRpbmcnKTtcclxuICAgIGNvbnN0IHggPSBjdXJyZW50U29ydE9yZGVyLmxlbmd0aCA9PT0gMCA/XHJcbiAgICAgICAgLTMgOiAvLyBzdGFycyBkZXNjXHJcbiAgICAgICAgY3VycmVudFNvcnRPcmRlcltjdXJyZW50U29ydE9yZGVyLmxlbmd0aCAtIDFdO1xyXG4gICAgY29uc3QgaW5kZXggPSBNYXRoLmFicyh4KSAtIDE7XHJcbiAgICAkKCQoJyNzdW1tYXJ5LXRhYmxlID4gdGhlYWQgPiB0ciA+IHRoJylbaW5kZXhdKVxyXG4gICAgICAgIC5hZGRDbGFzcygnc29ydGVkJykuYWRkQ2xhc3MoeCA+IDAgPyAnYXNjZW5kaW5nJyA6ICdkZXNjZW5kaW5nJyk7XHJcbn1cclxuXHJcbiQoKCkgPT4ge1xyXG4gICAgc2V0UXVlcnlBY2NvcmRpbmdUb0hhc2goKTtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgKCkgPT4ge1xyXG4gICAgICAgIHNldFF1ZXJ5QWNjb3JkaW5nVG9IYXNoKCk7XHJcbiAgICAgICAgZHJhd1RhYmxlRm9yQ3VycmVudEZpbHRlcmluZygpO1xyXG4gICAgfSk7XHJcbiAgICBjb25zdCBvbkNoYW5nZSA9ICgpID0+IHtcclxuICAgICAgICBkcmF3VGFibGVGb3JDdXJyZW50RmlsdGVyaW5nKCk7XHJcbiAgICB9O1xyXG4gICAgZm9yIChjb25zdCBuYW1lIG9mIFsnZmlsdGVyX2FwcHJvdmVkX3N0YXR1cycsICdmaWx0ZXJfbW9kZScsICdmaWx0ZXJfZmNfbGV2ZWwnXSlcclxuICAgICAgICAkKGBzZWxlY3RbbmFtZT1cIiR7bmFtZX1cIl1gKS5vbignY2hhbmdlJywgb25DaGFuZ2UpO1xyXG4gICAgZm9yIChjb25zdCBuYW1lIG9mIFsnZmlsdGVyX3NlYXJjaF9xdWVyeSddKVxyXG4gICAgICAgICQoYGlucHV0W25hbWU9XCIke25hbWV9XCJdYCkub24oJ2lucHV0Jywgb25DaGFuZ2UpO1xyXG5cclxuICAgIGNvbnN0IHRoTGlzdCA9ICQoJyNzdW1tYXJ5LXRhYmxlID4gdGhlYWQgPiB0ciA+IHRoJyk7XHJcbiAgICBzb3J0S2V5cy5mb3JFYWNoKChfLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICQuZGF0YSh0aExpc3RbaW5kZXhdLCAndGhJbmRleCcsIGluZGV4KTtcclxuICAgIH0pO1xyXG4gICAgJC5nZXRKU09OKCdkYXRhL3N1bW1hcnkuanNvbicpLnRoZW4oKGRhdGE6IFN1bW1hcnlSb3dEYXRhW10sIF8sIHhocikgPT4ge1xyXG4gICAgICAgIGNvbnN0IGxhc3RfbW9kaWZpZWQgPSBuZXcgRGF0ZSh4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoJ0xhc3QtTW9kaWZpZWQnKSBhcyBzdHJpbmcpO1xyXG4gICAgICAgICQoJyNsYXN0LXVwZGF0ZS10aW1lJylcclxuICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGltZT4nKVxyXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2RhdGV0aW1lJywgbGFzdF9tb2RpZmllZC50b0lTT1N0cmluZygpKVxyXG4gICAgICAgICAgICAgICAgLnRleHQobGFzdF9tb2RpZmllZC50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0pKTtcclxuICAgICAgICBjb25zdCBwYWQgPSAoeDogbnVtYmVyKSA9PiAoeCA8IDEwID8gJzAnIDogJycpICsgeDtcclxuICAgICAgICBjb25zdCBtb2RlX2ljb25zID0gW1xyXG4gICAgICAgICAgICAnZXhjaGFuZ2UgaWNvbicsXHJcbiAgICAgICAgICAgICcnLFxyXG4gICAgICAgICAgICAndGhlbWUgaWNvbicsXHJcbiAgICAgICAgICAgICcnLFxyXG4gICAgICAgIF07XHJcbiAgICAgICAgY29uc3QgYXBwcm92ZWRfc3RhdHVzX2ljb25zID0gW1xyXG4gICAgICAgICAgICAnaGVscCBpY29uJyxcclxuICAgICAgICAgICAgJ2FuZ2xlIGRvdWJsZSB1cCBpY29uJyxcclxuICAgICAgICAgICAgJ2ZpcmUgaWNvbicsXHJcbiAgICAgICAgICAgICdjaGVja21hcmsgaWNvbicsXHJcbiAgICAgICAgICAgICdlbXB0eSBoZWFydCBpY29uJyxcclxuICAgICAgICBdO1xyXG4gICAgICAgIHN1bW1hcnlSb3dzID0gZGF0YS5tYXAoeCA9PiBuZXcgU3VtbWFyeVJvdyh4KSk7XHJcbiAgICAgICAgdW5zb3J0ZWRUYWJsZVJvd3MgPSBzdW1tYXJ5Um93cy5tYXAocm93ID0+XHJcbiAgICAgICAgICAgICQoJzx0cj4nKS5hcHBlbmQoW1xyXG4gICAgICAgICAgICAgICAgW1xyXG4gICAgICAgICAgICAgICAgICAgICQoJzxpPicpLmFkZENsYXNzKGFwcHJvdmVkX3N0YXR1c19pY29uc1tyb3cuYXBwcm92ZWRfc3RhdHVzXSksXHJcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocm93LmFwcHJvdmVkX2RhdGUuc3BsaXQoJyAnKVswXSlcclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBbXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnPGk+JykuYWRkQ2xhc3MobW9kZV9pY29uc1tyb3cubW9kZV0pLFxyXG4gICAgICAgICAgICAgICAgICAgICQoJzxhPicpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdocmVmJywgYGh0dHBzOi8vb3N1LnBweS5zaC9iLyR7cm93LmJlYXRtYXBfaWR9P209MmApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KHJvdy5kaXNwbGF5X3N0cmluZyksXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnPGRpdiBzdHlsZT1cImZsb2F0OnJpZ2h0XCI+JykuYXBwZW5kKFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnPGE+PGkgY2xhc3M9XCJpbWFnZSBpY29uXCI+JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdocmVmJywgYGh0dHBzOi8vYi5wcHkuc2gvdGh1bWIvJHtyb3cuYmVhdG1hcHNldF9pZH0uanBnYCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJzxhPjxpIGNsYXNzPVwiZG93bmxvYWQgaWNvblwiPicpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignaHJlZicsIGBodHRwczovL29zdS5wcHkuc2gvZC8ke3Jvdy5iZWF0bWFwc2V0X2lkfW5gKVxyXG4gICAgICAgICAgICAgICAgICAgIF0pXHJcbiAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgcm93LnN0YXJzLnRvRml4ZWQoMiksXHJcbiAgICAgICAgICAgICAgICByb3cucHAudG9GaXhlZCgwKSxcclxuICAgICAgICAgICAgICAgIGAke01hdGguZmxvb3Iocm93LmhpdF9sZW5ndGggLyA2MCl9OiR7cGFkKE1hdGguZmxvb3Iocm93LmhpdF9sZW5ndGggJSA2MCkpfWAsXHJcbiAgICAgICAgICAgICAgICByb3cubWF4X2NvbWJvLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICByb3cuYXBwcm9hY2hfcmF0ZS50b0ZpeGVkKDEpLFxyXG4gICAgICAgICAgICAgICAgcm93LmNpcmNsZV9zaXplLnRvRml4ZWQoMSksXHJcbiAgICAgICAgICAgICAgICAgICAgcm93Lm1pbl9taXNzZXMgIT09IDAgPyAocm93Lm1pbl9taXNzZXMgPT09IDEgPyAnMSBtaXNzJyA6IHJvdy5taW5fbWlzc2VzICsgJyBtaXNzZXMnKSA6XHJcbiAgICAgICAgICAgICAgICAgICAgW3Jvdy5mY05NLCByb3cuZmNIRCwgcm93LmZjSFIsIHJvdy5mY0hESFIsIHJvdy5mY0RULCByb3cuZmNIRERUXS5qb2luKCcsICcpXHJcbiAgICAgICAgICAgIF0ubWFwKHggPT4gJCgnPHRkPicpLmFwcGVuZCh4KSkpWzBdIGFzIEhUTUxUYWJsZVJvd0VsZW1lbnQpO1xyXG4gICAgICAgIGRyYXdUYWJsZUZvckN1cnJlbnRGaWx0ZXJpbmcoKTtcclxuICAgICAgICAkKCcjc3VtbWFyeS10YWJsZS1sb2FkZXInKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICB9KTtcclxuICAgIHRoTGlzdC5jbGljaygoZXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCB0aCA9ICQoZXZlbnQudGFyZ2V0KTtcclxuICAgICAgICBsZXQgc2lnbjtcclxuICAgICAgICBpZiAodGguaGFzQ2xhc3MoJ3NvcnRlZCcpKVxyXG4gICAgICAgICAgICBzaWduID0gdGguaGFzQ2xhc3MoJ2Rlc2NlbmRpbmcnKSA/IDEgOiAtMTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHNpZ24gPSB0aC5oYXNDbGFzcygnZGVzYy1maXJzdCcpID8gLTEgOiAxO1xyXG4gICAgICAgIGNvbnN0IHRoSW5kZXggPSB0aC5kYXRhKCd0aEluZGV4JykgYXMgbnVtYmVyO1xyXG4gICAgICAgIGN1cnJlbnRTb3J0T3JkZXIucHVzaCgodGhJbmRleCArIDEpICogc2lnbik7XHJcbiAgICAgICAgY3VycmVudFNvcnRPcmRlciA9IHNpbXBseVNvcnRPcmRlcihjdXJyZW50U29ydE9yZGVyKTtcclxuICAgICAgICBzZXRUYWJsZUhlYWRTb3J0aW5nTWFyaygpO1xyXG4gICAgICAgIGRyYXdUYWJsZUZvckN1cnJlbnRGaWx0ZXJpbmcoKTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbn1cclxuIl19