"use strict";
/// <reference types="jquery" />
var ListMaps;
(function (ListMaps) {
    var SummaryRow = /** @class */ (function () {
        function SummaryRow(data) {
            this.data = data;
            this.approved_status = data[0], this.approved_date = data[1], this.mode = data[2], this.beatmap_id = data[3], this.beatmapset_id = data[4], this.display_string = data[5], this.stars = data[6], this.pp = data[7], this.hit_length = data[8], this.max_combo = data[9], this.approach_rate = data[10], this.circle_size = data[11], this.min_misses = data[12], this.fcNM = data[13], this.fcHD = data[14], this.fcHR = data[15], this.fcHDHR = data[16], this.fcDT = data[17], this.fcHDDT = data[18];
            this.display_string_lower = this.display_string.toLowerCase();
        }
        return SummaryRow;
    }());
    var summaryRows = [];
    var unsortedTableRows = [];
    var currentOrderingIndices = [];
    var previousIndices = '';
    function drawTable(indices) {
        var str = indices.join(',');
        if (previousIndices === str)
            return;
        previousIndices = str;
        $('#summary-table > tbody')
            .html('')
            .append(indices.map(function (index) { return unsortedTableRows[index]; }));
    }
    var SearchQuery = /** @class */ (function () {
        function SearchQuery(source) {
            this.source = source;
            var key_to_property_name = {
                'status': 'approved_status',
                'mode': 'mode',
                'stars': 'stars',
                'pp': 'pp',
                'length': 'hit_length',
                'combo': 'max_combo',
                'ar': 'approach_rate',
                'cs': 'circle_size',
            };
            var check_func_source = 'return true';
            this.hash_str = '';
            for (var _i = 0, _a = source.split(' '); _i < _a.length; _i++) {
                var token = _a[_i];
                var trimmed = token.trim();
                if (trimmed === '')
                    continue;
                var match = /(status|mode|stars|pp|length|combo|ar|cs)(<|<=|>|>=|=|!=)([-\d\.]+)/.exec(trimmed);
                if (match) {
                    var key = match[1];
                    var rel = match[2] === '=' ? '==' : match[2];
                    var val = parseFloat(match[3]);
                    if (isNaN(val))
                        continue;
                    var prop = key_to_property_name[key];
                    this.hash_str += ' ' + prop + ' ' + rel + ' ' + val;
                    check_func_source += "&&row." + prop + rel + val;
                }
                else {
                    var str = trimmed.toLowerCase();
                    var escaped = JSON.stringify(str);
                    this.hash_str += ' ' + escaped;
                    check_func_source += "&&row.display_string_lower.indexOf(" + escaped + ")!==-1";
                }
            }
            this.check = new Function('row', check_func_source);
        }
        return SearchQuery;
    }());
    function drawTableForCurrentFiltering() {
        var filter_approved_status = parseInt($('*[name="filter_approved_status"]').val());
        var filter_mode = $('*[name="filter_mode"]').val();
        var filter_search_query = new SearchQuery($('*[name="filter_search_query"]').val());
        var filter_fc_level = parseInt($('*[name="filter_fc_level"]').val());
        var filter_expression = $('*[name="filter_expression"]').val();
        var get_fc_level = function (row) {
            if (row.min_misses !== 0)
                return 1;
            if (row.fcDT !== 0 || row.fcHDDT !== 0)
                return 8;
            if (row.fcNM === 0 && row.fcHD === 0 && row.fcHR === 0 && row.fcHDHR === 0)
                return 2;
            if (row.fcNM === 0 && row.fcHD === 0)
                return 3;
            if (row.fcHD === 0)
                return 4;
            if (row.fcHR === 0 && row.fcHDHR === 0)
                return 5;
            if (row.fcHDHR === 0)
                return 6;
            return 7;
        };
        var indices = currentOrderingIndices.filter(function (index) {
            var row = summaryRows[index];
            if (filter_approved_status === 1 &&
                (row.approved_status !== 1 && row.approved_status !== 2))
                return false;
            if (filter_approved_status === 2 && row.approved_status !== 4)
                return false;
            if (filter_mode === '1' && row.mode !== 0)
                return false;
            if (filter_mode === '2' && row.mode !== 2)
                return false;
            if (!filter_search_query.check(row))
                return false;
            if (filter_fc_level !== 0 && get_fc_level(row) !== filter_fc_level)
                return false;
            return true;
        });
        drawTable(indices);
    }
    $(function () {
        var onChange = function () {
            drawTableForCurrentFiltering();
        };
        for (var _i = 0, _a = ['filter_approved_status', 'filter_mode', 'filter_fc_level']; _i < _a.length; _i++) {
            var name_1 = _a[_i];
            $("select[name=\"" + name_1 + "\"]").on('change', onChange);
        }
        for (var _b = 0, _c = ['filter_search_query']; _b < _c.length; _b++) {
            var name_2 = _c[_b];
            $("input[name=\"" + name_2 + "\"]").on('input', onChange);
        }
        var thList = $('#summary-table > thead > tr > th');
        [
            function (x) { return x.approved_date; },
            function (x) { return x.display_string; },
            function (x) { return x.stars; },
            function (x) { return x.pp; },
            function (x) { return x.hit_length; },
            function (x) { return x.max_combo; },
            function (x) { return x.approach_rate; },
            function (x) { return x.circle_size; },
            function (x) {
                return x.fcHDDT * 2 + x.fcDT * 1e8 +
                    x.fcHDHR * 2 + x.fcHR * 1e4 +
                    x.fcHD * 2 + x.fcNM -
                    x.min_misses;
            },
        ].forEach(function (sortKey, index) {
            $.data(thList[index], 'sortKey', sortKey);
        });
        $.getJSON('data/summary.json').then(function (data, _, xhr) {
            var last_modified = new Date(xhr.getResponseHeader('Last-Modified'));
            $('#last-update-time')
                .attr('datetime', last_modified.toISOString())
                .text(last_modified.toISOString().split('T')[0]);
            var pad = function (x) { return (x < 10 ? '0' : '') + x; };
            var mode_icons = [
                'exchange icon',
                '',
                'theme icon',
                '',
            ];
            var approved_status_icons = [
                'help icon',
                'angle double up icon',
                'fire icon',
                'checkmark icon',
                'empty heart icon',
            ];
            summaryRows = data.map(function (x) { return new SummaryRow(x); });
            unsortedTableRows = summaryRows.map(function (row) {
                return $('<tr>').append([
                    [
                        $('<i>').addClass(approved_status_icons[row.approved_status]),
                        document.createTextNode(row.approved_date.split(' ')[0])
                    ],
                    [
                        $('<i>').addClass(mode_icons[row.mode]),
                        $('<a>')
                            .attr('href', "https://osu.ppy.sh/b/" + row.beatmap_id + "?m=2")
                            .text(row.display_string),
                        $('<div style="float:right">').append([
                            $('<a><i class="image icon">')
                                .attr('href', "https://b.ppy.sh/thumb/" + row.beatmapset_id + ".jpg"),
                            $('<a><i class="download icon">')
                                .attr('href', "https://osu.ppy.sh/d/" + row.beatmapset_id + "n")
                        ])
                    ],
                    row.stars.toFixed(2),
                    row.pp.toFixed(0),
                    Math.floor(row.hit_length / 60) + ":" + pad(Math.floor(row.hit_length % 60)),
                    row.max_combo.toString(),
                    row.approach_rate.toFixed(1),
                    row.circle_size.toFixed(1),
                    row.min_misses !== 0 ? (row.min_misses === 1 ? '1 miss' : row.min_misses + ' misses') :
                        [row.fcNM, row.fcHD, row.fcHR, row.fcHDHR, row.fcDT, row.fcHDDT].join(' / ')
                ].map(function (x) { return $('<td>').append(x); }))[0];
            });
            currentOrderingIndices = summaryRows.map(function (_, index) { return index; });
            drawTableForCurrentFiltering();
            $('#summary-table-loader').removeClass('active');
        });
        thList.click(function (event) {
            var th = $(event.target);
            thList.filter('.sorted')
                .filter(function (_, x) { return x !== event.target; })
                .removeClass('sorted descending ascending');
            if (th.hasClass('sorted'))
                th.toggleClass('descending ascending');
            else
                th.addClass('sorted')
                    .addClass(th.hasClass('desc-first') ? 'descending' : 'ascending');
            var sortKey = th.data('sortKey');
            var sign = th.hasClass('descending') ? -1 : 1;
            currentOrderingIndices.sort(function (x, y) {
                var kx = sortKey(summaryRows[x]);
                var ky = sortKey(summaryRows[y]);
                return (kx < ky ? -1 : kx > ky ? 1 : 0) * sign;
            });
            drawTableForCurrentFiltering();
        });
    });
})(ListMaps || (ListMaps = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1tYXBzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2xpc3QtbWFwcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsZ0NBQWdDO0FBQ2hDLElBQVUsUUFBUSxDQXNRakI7QUF0UUQsV0FBVSxRQUFRO0lBZWxCO1FBcUJJLG9CQUE2QixJQUFvQjtZQUFwQixTQUFJLEdBQUosSUFBSSxDQUFnQjtZQUV6Qyw4QkFBb0IsRUFDcEIsNEJBQWtCLEVBQ2xCLG1CQUFTLEVBQ1QseUJBQWUsRUFDZiw0QkFBa0IsRUFDbEIsNkJBQW1CLEVBQ25CLG9CQUFVLEVBQ1YsaUJBQU8sRUFDUCx5QkFBZSxFQUNmLHdCQUFjLEVBQ2QsNkJBQWtCLEVBQ2xCLDJCQUFnQixFQUNoQiwwQkFBZSxFQUNmLG9CQUFTLEVBQ1Qsb0JBQVMsRUFDVCxvQkFBUyxFQUNULHNCQUFXLEVBQ1gsb0JBQVMsRUFDVCxzQkFBVyxDQUNOO1lBQ1QsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbEUsQ0FBQztRQUNMLGlCQUFDO0lBQUQsQ0FBQyxBQTdDRCxJQTZDQztJQUlELElBQUksV0FBVyxHQUFpQixFQUFFLENBQUM7SUFDbkMsSUFBSSxpQkFBaUIsR0FBMEIsRUFBRSxDQUFDO0lBQ2xELElBQUksc0JBQXNCLEdBQWEsRUFBRSxDQUFDO0lBRTFDLElBQUksZUFBZSxHQUFHLEVBQUUsQ0FBQztJQUN6QixtQkFBbUIsT0FBaUI7UUFDaEMsSUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM5QixFQUFFLENBQUMsQ0FBQyxlQUFlLEtBQUssR0FBRyxDQUFDO1lBQUMsTUFBTSxDQUFDO1FBQ3BDLGVBQWUsR0FBRyxHQUFHLENBQUM7UUFDdEIsQ0FBQyxDQUFDLHdCQUF3QixDQUFDO2FBQ3RCLElBQUksQ0FBQyxFQUFFLENBQUM7YUFDUixNQUFNLENBQUMs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LENBQUM7Z0JBQ25DLE1BQU0sQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztZQUNuRCxDQUFDLENBQUMsQ0FBQztZQUNILDRCQUE0QixFQUFFLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUVILENBQUMsRUF0UVMsUUFBUSxLQUFSLFFBQVEsUUFzUWpCIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgdHlwZXM9XCJqcXVlcnlcIiAvPlxyXG5uYW1lc3BhY2UgTGlzdE1hcHMge1xyXG5cclxuaW50ZXJmYWNlIEpRdWVyeSB7XHJcbiAgICB0YWJsZXNvcnQoKTogdm9pZDtcclxuICAgIGRhdGEoa2V5OiAnc29ydEJ5Jywga2V5RnVuYzogKFxyXG4gICAgICAgIHRoOiBIVE1MVGFibGVIZWFkZXJDZWxsRWxlbWVudCxcclxuICAgICAgICB0ZDogSFRNTFRhYmxlRGF0YUNlbGxFbGVtZW50LFxyXG4gICAgICAgIHRhYmxlc29ydDogYW55KSA9PiB2b2lkKTogdGhpcztcclxufVxyXG5cclxudHlwZSBTdW1tYXJ5Um93RGF0YSA9XHJcbltcclxuICAgIG51bWJlciwgc3RyaW5nLCBudW1iZXIsIHN0cmluZywgc3RyaW5nLCBzdHJpbmcsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsXHJcbiAgICBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlclxyXG5dO1xyXG5jbGFzcyBTdW1tYXJ5Um93IHtcclxuICAgIGFwcHJvdmVkX3N0YXR1czogbnVtYmVyO1xyXG4gICAgYXBwcm92ZWRfZGF0ZTogc3RyaW5nO1xyXG4gICAgbW9kZTogbnVtYmVyO1xyXG4gICAgYmVhdG1hcF9pZDogc3RyaW5nO1xyXG4gICAgYmVhdG1hcHNldF9pZDogc3RyaW5nO1xyXG4gICAgZGlzcGxheV9zdHJpbmc6IHN0cmluZztcclxuICAgIGRpc3BsYXlfc3RyaW5nX2xvd2VyOiBzdHJpbmc7XHJcbiAgICBzdGFyczogbnVtYmVyO1xyXG4gICAgcHA6IG51bWJlcjtcclxuICAgIGhpdF9sZW5ndGg6IG51bWJlcjtcclxuICAgIG1heF9jb21ibzogbnVtYmVyO1xyXG4gICAgYXBwcm9hY2hfcmF0ZTogbnVtYmVyO1xyXG4gICAgY2lyY2xlX3NpemU6IG51bWJlcjtcclxuICAgIG1pbl9taXNzZXM6IG51bWJlcjtcclxuICAgIGZjTk06IG51bWJlcjtcclxuICAgIGZjSEQ6IG51bWJlcjtcclxuICAgIGZjSFI6IG51bWJlcjtcclxuICAgIGZjSERIUjogbnVtYmVyO1xyXG4gICAgZmNEVDogbnVtYmVyO1xyXG4gICAgZmNIRERUOiBudW1iZXI7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGRhdGE6IFN1bW1hcnlSb3dEYXRhKSB7XHJcbiAgICAgICAgW1xyXG4gICAgICAgICAgICB0aGlzLmFwcHJvdmVkX3N0YXR1cyxcclxuICAgICAgICAgICAgdGhpcy5hcHByb3ZlZF9kYXRlLFxyXG4gICAgICAgICAgICB0aGlzLm1vZGUsXHJcbiAgICAgICAgICAgIHRoaXMuYmVhdG1hcF9pZCxcclxuICAgICAgICAgICAgdGhpcy5iZWF0bWFwc2V0X2lkLFxyXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlfc3RyaW5nLFxyXG4gICAgICAgICAgICB0aGlzLnN0YXJzLFxyXG4gICAgICAgICAgICB0aGlzLnBwLFxyXG4gICAgICAgICAgICB0aGlzLmhpdF9sZW5ndGgsXHJcbiAgICAgICAgICAgIHRoaXMubWF4X2NvbWJvLFxyXG4gICAgICAgICAgICB0aGlzLmFwcHJvYWNoX3JhdGUsXHJcbiAgICAgICAgICAgIHRoaXMuY2lyY2xlX3NpemUsXHJcbiAgICAgICAgICAgIHRoaXMubWluX21pc3NlcyxcclxuICAgICAgICAgICAgdGhpcy5mY05NLFxyXG4gICAgICAgICAgICB0aGlzLmZjSEQsXHJcbiAgICAgICAgICAgIHRoaXMuZmNIUixcclxuICAgICAgICAgICAgdGhpcy5mY0hESFIsXHJcbiAgICAgICAgICAgIHRoaXMuZmNEVCxcclxuICAgICAgICAgICAgdGhpcy5mY0hERFQsXHJcbiAgICAgICAgXSA9IGRhdGE7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5X3N0cmluZ19sb3dlciA9IHRoaXMuZGlzcGxheV9zdHJpbmcudG9Mb3dlckNhc2UoKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcblxyXG5sZXQgc3VtbWFyeVJvd3M6IFN1bW1hcnlSb3dbXSA9IFtdO1xyXG5sZXQgdW5zb3J0ZWRUYWJsZVJvd3M6IEhUTUxUYWJsZVJvd0VsZW1lbnRbXSA9IFtdO1xyXG5sZXQgY3VycmVudE9yZGVyaW5nSW5kaWNlczogbnVtYmVyW10gPSBbXTtcclxuXHJcbmxldCBwcmV2aW91c0luZGljZXMgPSAnJztcclxuZnVuY3Rpb24gZHJhd1RhYmxlKGluZGljZXM6IG51bWJlcltdKSB7XHJcbiAgICBjb25zdCBzdHIgPSBpbmRpY2VzLmpvaW4oJywnKTtcclxuICAgIGlmIChwcmV2aW91c0luZGljZXMgPT09IHN0cikgcmV0dXJuO1xyXG4gICAgcHJldmlvdXNJbmRpY2VzID0gc3RyO1xyXG4gICAgJCgnI3N1bW1hcnktdGFibGUgPiB0Ym9keScpXHJcbiAgICAgICAgLmh0bWwoJycpXHJcbiAgICAgICAgLmFwcGVuZChpbmRpY2VzLm1hcChpbmRleCA9PiB1bnNvcnRlZFRhYmxlUm93c1tpbmRleF0pKTtcclxufVxyXG5cclxuXHJcbmNsYXNzIFNlYXJjaFF1ZXJ5IHtcclxuICAgIHB1YmxpYyByZWFkb25seSBjaGVjazogKHJvdzogU3VtbWFyeVJvdykgPT4gYm9vbGVhbjtcclxuICAgIHB1YmxpYyByZWFkb25seSBoYXNoX3N0cjogc3RyaW5nO1xyXG4gICAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IHNvdXJjZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qga2V5X3RvX3Byb3BlcnR5X25hbWUgPSB7XHJcbiAgICAgICAgICAgICdzdGF0dXMnOiAnYXBwcm92ZWRfc3RhdHVzJyxcclxuICAgICAgICAgICAgJ21vZGUnOiAnbW9kZScsXHJcbiAgICAgICAgICAgICdzdGFycyc6ICdzdGFycycsXHJcbiAgICAgICAgICAgICdwcCc6ICdwcCcsXHJcbiAgICAgICAgICAgICdsZW5ndGgnOiAnaGl0X2xlbmd0aCcsXHJcbiAgICAgICAgICAgICdjb21ibyc6ICdtYXhfY29tYm8nLFxyXG4gICAgICAgICAgICAnYXInOiAnYXBwcm9hY2hfcmF0ZScsXHJcbiAgICAgICAgICAgICdjcyc6ICdjaXJjbGVfc2l6ZScsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBsZXQgY2hlY2tfZnVuY19zb3VyY2UgPSAncmV0dXJuIHRydWUnO1xyXG4gICAgICAgIHRoaXMuaGFzaF9zdHIgPSAnJztcclxuICAgICAgICBmb3IgKGNvbnN0IHRva2VuIG9mIHNvdXJjZS5zcGxpdCgnICcpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSB0b2tlbi50cmltKCk7XHJcbiAgICAgICAgICAgIGlmICh0cmltbWVkID09PSAnJykgY29udGludWU7XHJcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID1cclxuICAgICAgICAgICAgICAgIC8oc3RhdHVzfG1vZGV8c3RhcnN8cHB8bGVuZ3RofGNvbWJvfGFyfGNzKSg8fDw9fD58Pj18PXwhPSkoWy1cXGRcXC5dKykvLmV4ZWModHJpbW1lZCk7XHJcbiAgICAgICAgICAgIGlmIChtYXRjaCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gbWF0Y2hbMV07XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZWwgPSBtYXRjaFsyXSA9PT0gJz0nID8gJz09JyA6IG1hdGNoWzJdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsID0gcGFyc2VGbG9hdChtYXRjaFszXSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4odmFsKSkgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9wID0gKGtleV90b19wcm9wZXJ0eV9uYW1lIGFzIGFueSlba2V5XTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGFzaF9zdHIgKz0gJyAnICsgcHJvcCArICcgJyArIHJlbCArICcgJyArIHZhbDtcclxuICAgICAgICAgICAgICAgIGNoZWNrX2Z1bmNfc291cmNlICs9IGAmJnJvdy4ke3Byb3B9JHtyZWx9JHt2YWx9YDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0ciA9IHRyaW1tZWQudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVzY2FwZWQgPSBKU09OLnN0cmluZ2lmeShzdHIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oYXNoX3N0ciArPSAnICcgKyBlc2NhcGVkO1xyXG4gICAgICAgICAgICAgICAgY2hlY2tfZnVuY19zb3VyY2UgKz0gYCYmcm93LmRpc3BsYXlfc3RyaW5nX2xvd2VyLmluZGV4T2YoJHtlc2NhcGVkfSkhPT0tMWA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGVjayA9IG5ldyBGdW5jdGlvbigncm93JywgY2hlY2tfZnVuY19zb3VyY2UpIGFzIGFueTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGRyYXdUYWJsZUZvckN1cnJlbnRGaWx0ZXJpbmcoKSB7XHJcbiAgICBjb25zdCBmaWx0ZXJfYXBwcm92ZWRfc3RhdHVzID0gcGFyc2VJbnQoJCgnKltuYW1lPVwiZmlsdGVyX2FwcHJvdmVkX3N0YXR1c1wiXScpLnZhbCgpIGFzIHN0cmluZyk7XHJcbiAgICBjb25zdCBmaWx0ZXJfbW9kZSA9ICQoJypbbmFtZT1cImZpbHRlcl9tb2RlXCJdJykudmFsKCkgYXMgc3RyaW5nO1xyXG4gICAgY29uc3QgZmlsdGVyX3NlYXJjaF9xdWVyeSA9IG5ldyBTZWFyY2hRdWVyeSgoJCgnKltuYW1lPVwiZmlsdGVyX3NlYXJjaF9xdWVyeVwiXScpLnZhbCgpIGFzIHN0cmluZykpO1xyXG4gICAgY29uc3QgZmlsdGVyX2ZjX2xldmVsID0gcGFyc2VJbnQoJCgnKltuYW1lPVwiZmlsdGVyX2ZjX2xldmVsXCJdJykudmFsKCkgYXMgc3RyaW5nKTtcclxuICAgIGNvbnN0IGZpbHRlcl9leHByZXNzaW9uID0gJCgnKltuYW1lPVwiZmlsdGVyX2V4cHJlc3Npb25cIl0nKS52YWwoKSBhcyBzdHJpbmc7XHJcblxyXG4gICAgY29uc3QgZ2V0X2ZjX2xldmVsID0gKHJvdzogU3VtbWFyeVJvdykgPT4ge1xyXG4gICAgICAgIGlmIChyb3cubWluX21pc3NlcyAhPT0gMCkgcmV0dXJuIDE7XHJcbiAgICAgICAgaWYgKHJvdy5mY0RUICE9PSAwIHx8IHJvdy5mY0hERFQgIT09IDApIHJldHVybiA4O1xyXG4gICAgICAgIGlmIChyb3cuZmNOTSA9PT0gMCAmJiByb3cuZmNIRCA9PT0gMCAmJiByb3cuZmNIUiA9PT0gMCAmJiByb3cuZmNIREhSID09PSAwKSByZXR1cm4gMjtcclxuICAgICAgICBpZiAocm93LmZjTk0gPT09IDAgJiYgcm93LmZjSEQgPT09IDApIHJldHVybiAzO1xyXG4gICAgICAgIGlmIChyb3cuZmNIRCA9PT0gMCkgcmV0dXJuIDQ7XHJcbiAgICAgICAgaWYgKHJvdy5mY0hSID09PSAwICYmIHJvdy5mY0hESFIgPT09IDApIHJldHVybiA1O1xyXG4gICAgICAgIGlmIChyb3cuZmNIREhSID09PSAwKSByZXR1cm4gNjtcclxuICAgICAgICByZXR1cm4gNztcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgaW5kaWNlcyA9IGN1cnJlbnRPcmRlcmluZ0luZGljZXMuZmlsdGVyKGluZGV4ID0+IHtcclxuICAgICAgICBjb25zdCByb3cgPSBzdW1tYXJ5Um93c1tpbmRleF07XHJcblxyXG4gICAgICAgIGlmIChmaWx0ZXJfYXBwcm92ZWRfc3RhdHVzID09PSAxICYmXHJcbiAgICAgICAgICAgIChyb3cuYXBwcm92ZWRfc3RhdHVzICE9PSAxICYmIHJvdy5hcHByb3ZlZF9zdGF0dXMgIT09IDIpKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgaWYgKGZpbHRlcl9hcHByb3ZlZF9zdGF0dXMgPT09IDIgJiYgcm93LmFwcHJvdmVkX3N0YXR1cyAhPT0gNClcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICBpZiAoZmlsdGVyX21vZGUgPT09ICcxJyAmJiByb3cubW9kZSAhPT0gMClcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIGlmIChmaWx0ZXJfbW9kZSA9PT0gJzInICYmIHJvdy5tb2RlICE9PSAyKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmICghZmlsdGVyX3NlYXJjaF9xdWVyeS5jaGVjayhyb3cpKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmIChmaWx0ZXJfZmNfbGV2ZWwgIT09IDAgJiYgZ2V0X2ZjX2xldmVsKHJvdykgIT09IGZpbHRlcl9mY19sZXZlbClcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0pO1xyXG4gICAgZHJhd1RhYmxlKGluZGljZXMpO1xyXG59XHJcblxyXG4kKCgpID0+IHtcclxuICAgIGNvbnN0IG9uQ2hhbmdlID0gKCkgPT4ge1xyXG4gICAgICAgIGRyYXdUYWJsZUZvckN1cnJlbnRGaWx0ZXJpbmcoKTtcclxuICAgIH07XHJcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgWydmaWx0ZXJfYXBwcm92ZWRfc3RhdHVzJywgJ2ZpbHRlcl9tb2RlJywgJ2ZpbHRlcl9mY19sZXZlbCddKVxyXG4gICAgICAgICQoYHNlbGVjdFtuYW1lPVwiJHtuYW1lfVwiXWApLm9uKCdjaGFuZ2UnLCBvbkNoYW5nZSk7XHJcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgWydmaWx0ZXJfc2VhcmNoX3F1ZXJ5J10pXHJcbiAgICAgICAgJChgaW5wdXRbbmFtZT1cIiR7bmFtZX1cIl1gKS5vbignaW5wdXQnLCBvbkNoYW5nZSk7XHJcblxyXG4gICAgY29uc3QgdGhMaXN0ID0gJCgnI3N1bW1hcnktdGFibGUgPiB0aGVhZCA+IHRyID4gdGgnKTtcclxuICAgIFtcclxuICAgICAgICAoeDogU3VtbWFyeVJvdykgPT4geC5hcHByb3ZlZF9kYXRlLFxyXG4gICAgICAgICh4OiBTdW1tYXJ5Um93KSA9PiB4LmRpc3BsYXlfc3RyaW5nLFxyXG4gICAgICAgICh4OiBTdW1tYXJ5Um93KSA9PiB4LnN0YXJzLFxyXG4gICAgICAgICh4OiBTdW1tYXJ5Um93KSA9PiB4LnBwLFxyXG4gICAgICAgICh4OiBTdW1tYXJ5Um93KSA9PiB4LmhpdF9sZW5ndGgsXHJcbiAgICAgICAgKHg6IFN1bW1hcnlSb3cpID0+IHgubWF4X2NvbWJvLFxyXG4gICAgICAgICh4OiBTdW1tYXJ5Um93KSA9PiB4LmFwcHJvYWNoX3JhdGUsXHJcbiAgICAgICAgKHg6IFN1bW1hcnlSb3cpID0+IHguY2lyY2xlX3NpemUsXHJcbiAgICAgICAgKHg6IFN1bW1hcnlSb3cpID0+XHJcbiAgICAgICAgICAgIHguZmNIRERUICogMiArIHguZmNEVCAqIDFlOCArXHJcbiAgICAgICAgICAgIHguZmNIREhSICogMiArIHguZmNIUiAqIDFlNCArXHJcbiAgICAgICAgICAgIHguZmNIRCAqIDIgKyB4LmZjTk0gLVxyXG4gICAgICAgICAgICB4Lm1pbl9taXNzZXMsXHJcbiAgICBdLmZvckVhY2goKHNvcnRLZXk6ICh4OiBTdW1tYXJ5Um93KSA9PiBudW1iZXIgfCBzdHJpbmcsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgJC5kYXRhKHRoTGlzdFtpbmRleF0sICdzb3J0S2V5Jywgc29ydEtleSk7XHJcbiAgICB9KTtcclxuICAgICQuZ2V0SlNPTignZGF0YS9zdW1tYXJ5Lmpzb24nKS50aGVuKChkYXRhOiBTdW1tYXJ5Um93RGF0YVtdLCBfLCB4aHIpID0+IHtcclxuICAgICAgICBjb25zdCBsYXN0X21vZGlmaWVkID0gbmV3IERhdGUoeGhyLmdldFJlc3BvbnNlSGVhZGVyKCdMYXN0LU1vZGlmaWVkJykgYXMgc3RyaW5nKTtcclxuICAgICAgICAkKCcjbGFzdC11cGRhdGUtdGltZScpXHJcbiAgICAgICAgICAgIC5hdHRyKCdkYXRldGltZScsIGxhc3RfbW9kaWZpZWQudG9JU09TdHJpbmcoKSlcclxuICAgICAgICAgICAgLnRleHQobGFzdF9tb2RpZmllZC50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0pO1xyXG4gICAgICAgIGNvbnN0IHBhZCA9ICh4OiBudW1iZXIpID0+ICh4IDwgMTAgPyAnMCcgOiAnJykgKyB4O1xyXG4gICAgICAgIGNvbnN0IG1vZGVfaWNvbnMgPSBbXHJcbiAgICAgICAgICAgICdleGNoYW5nZSBpY29uJyxcclxuICAgICAgICAgICAgJycsXHJcbiAgICAgICAgICAgICd0aGVtZSBpY29uJyxcclxuICAgICAgICAgICAgJycsXHJcbiAgICAgICAgXTtcclxuICAgICAgICBjb25zdCBhcHByb3ZlZF9zdGF0dXNfaWNvbnMgPSBbXHJcbiAgICAgICAgICAgICdoZWxwIGljb24nLFxyXG4gICAgICAgICAgICAnYW5nbGUgZG91YmxlIHVwIGljb24nLFxyXG4gICAgICAgICAgICAnZmlyZSBpY29uJyxcclxuICAgICAgICAgICAgJ2NoZWNrbWFyayBpY29uJyxcclxuICAgICAgICAgICAgJ2VtcHR5IGhlYXJ0IGljb24nLFxyXG4gICAgICAgIF07XHJcbiAgICAgICAgc3VtbWFyeVJvd3MgPSBkYXRhLm1hcCh4ID0+IG5ldyBTdW1tYXJ5Um93KHgpKTtcclxuICAgICAgICB1bnNvcnRlZFRhYmxlUm93cyA9IHN1bW1hcnlSb3dzLm1hcChyb3cgPT5cclxuICAgICAgICAgICAgJCgnPHRyPicpLmFwcGVuZChbXHJcbiAgICAgICAgICAgICAgICBbXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnPGk+JykuYWRkQ2xhc3MoYXBwcm92ZWRfc3RhdHVzX2ljb25zW3Jvdy5hcHByb3ZlZF9zdGF0dXNdKSxcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShyb3cuYXBwcm92ZWRfZGF0ZS5zcGxpdCgnICcpWzBdKVxyXG4gICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgIFtcclxuICAgICAgICAgICAgICAgICAgICAkKCc8aT4nKS5hZGRDbGFzcyhtb2RlX2ljb25zW3Jvdy5tb2RlXSksXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnPGE+JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2hyZWYnLCBgaHR0cHM6Ly9vc3UucHB5LnNoL2IvJHtyb3cuYmVhdG1hcF9pZH0/bT0yYClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQocm93LmRpc3BsYXlfc3RyaW5nKSxcclxuICAgICAgICAgICAgICAgICAgICAkKCc8ZGl2IHN0eWxlPVwiZmxvYXQ6cmlnaHRcIj4nKS5hcHBlbmQoW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCc8YT48aSBjbGFzcz1cImltYWdlIGljb25cIj4nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2hyZWYnLCBgaHR0cHM6Ly9iLnBweS5zaC90aHVtYi8ke3Jvdy5iZWF0bWFwc2V0X2lkfS5qcGdgKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnPGE+PGkgY2xhc3M9XCJkb3dubG9hZCBpY29uXCI+JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdocmVmJywgYGh0dHBzOi8vb3N1LnBweS5zaC9kLyR7cm93LmJlYXRtYXBzZXRfaWR9bmApXHJcbiAgICAgICAgICAgICAgICAgICAgXSlcclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICByb3cuc3RhcnMudG9GaXhlZCgyKSxcclxuICAgICAgICAgICAgICAgIHJvdy5wcC50b0ZpeGVkKDApLFxyXG4gICAgICAgICAgICAgICAgYCR7TWF0aC5mbG9vcihyb3cuaGl0X2xlbmd0aCAvIDYwKX06JHtwYWQoTWF0aC5mbG9vcihyb3cuaGl0X2xlbmd0aCAlIDYwKSl9YCxcclxuICAgICAgICAgICAgICAgIHJvdy5tYXhfY29tYm8udG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgIHJvdy5hcHByb2FjaF9yYXRlLnRvRml4ZWQoMSksXHJcbiAgICAgICAgICAgICAgICByb3cuY2lyY2xlX3NpemUudG9GaXhlZCgxKSxcclxuICAgICAgICAgICAgICAgICAgICByb3cubWluX21pc3NlcyAhPT0gMCA/IChyb3cubWluX21pc3NlcyA9PT0gMSA/ICcxIG1pc3MnIDogcm93Lm1pbl9taXNzZXMgKyAnIG1pc3NlcycpIDpcclxuICAgICAgICAgICAgICAgICAgICBbcm93LmZjTk0sIHJvdy5mY0hELCByb3cuZmNIUiwgcm93LmZjSERIUiwgcm93LmZjRFQsIHJvdy5mY0hERFRdLmpvaW4oJyAvICcpXHJcbiAgICAgICAgICAgIF0ubWFwKHggPT4gJCgnPHRkPicpLmFwcGVuZCh4KSkpWzBdIGFzIEhUTUxUYWJsZVJvd0VsZW1lbnQpO1xyXG4gICAgICAgIGN1cnJlbnRPcmRlcmluZ0luZGljZXMgPSBzdW1tYXJ5Um93cy5tYXAoKF8sIGluZGV4KSA9PiBpbmRleCk7XHJcbiAgICAgICAgZHJhd1RhYmxlRm9yQ3VycmVudEZpbHRlcmluZygpO1xyXG4gICAgICAgICQoJyNzdW1tYXJ5LXRhYmxlLWxvYWRlcicpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgIH0pO1xyXG4gICAgdGhMaXN0LmNsaWNrKChldmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHRoID0gJChldmVudC50YXJnZXQpO1xyXG4gICAgICAgIHRoTGlzdC5maWx0ZXIoJy5zb3J0ZWQnKVxyXG4gICAgICAgICAgICAuZmlsdGVyKChfLCB4KSA9PiB4ICE9PSBldmVudC50YXJnZXQpXHJcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnc29ydGVkIGRlc2NlbmRpbmcgYXNjZW5kaW5nJyk7XHJcbiAgICAgICAgaWYgKHRoLmhhc0NsYXNzKCdzb3J0ZWQnKSlcclxuICAgICAgICAgICAgdGgudG9nZ2xlQ2xhc3MoJ2Rlc2NlbmRpbmcgYXNjZW5kaW5nJyk7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0aC5hZGRDbGFzcygnc29ydGVkJylcclxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyh0aC5oYXNDbGFzcygnZGVzYy1maXJzdCcpID8gJ2Rlc2NlbmRpbmcnIDogJ2FzY2VuZGluZycpO1xyXG4gICAgICAgIGNvbnN0IHNvcnRLZXkgPSB0aC5kYXRhKCdzb3J0S2V5JykgYXMgKHg6IFN1bW1hcnlSb3cpID0+IGFueTtcclxuICAgICAgICBjb25zdCBzaWduID0gdGguaGFzQ2xhc3MoJ2Rlc2NlbmRpbmcnKSA/IC0xIDogMTtcclxuICAgICAgICBjdXJyZW50T3JkZXJpbmdJbmRpY2VzLnNvcnQoKHgsIHkpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qga3ggPSBzb3J0S2V5KHN1bW1hcnlSb3dzW3hdKTtcclxuICAgICAgICAgICAgY29uc3Qga3kgPSBzb3J0S2V5KHN1bW1hcnlSb3dzW3ldKTtcclxuICAgICAgICAgICAgcmV0dXJuIChreCA8IGt5ID8gLTEgOiBreCA+IGt5ID8gMSA6IDApICogc2lnbjtcclxuICAgICAgICB9KTtcclxuICAgICAgICBkcmF3VGFibGVGb3JDdXJyZW50RmlsdGVyaW5nKCk7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG59XHJcbiJdfQ==